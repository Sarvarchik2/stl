INFO:     Will watch for changes in these directories: ['/Users/ula/Desktop/stl-admin/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [33064] using WatchFiles
INFO:     Started server process [33107]
INFO:     Waiting for application startup.
2026-02-12 17:21:14,429 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-12 17:21:14,429 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:21:14,430 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-12 17:21:14,430 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:21:14,431 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-12 17:21:14,431 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:21:14,431 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:14,433 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,433 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,436 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,436 INFO sqlalchemy.engine.Engine [cached since 0.00354s ago] ('cars_catalog', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine [cached since 0.004s ago] ('cars_price_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine [cached since 0.004412s ago] ('applications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine [cached since 0.004813s ago] ('application_status_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine [cached since 0.005183s ago] ('application_comments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine [cached since 0.005558s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.005827s ago] ('settings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.006061s ago] ('blacklist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.006283s ago] ('documents', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.006495s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine [cached since 0.006705s ago] ('stories', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine [cached since 0.006919s ago] ('story_slides', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,441 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('role', 'pg_catalog')
2026-02-12 17:21:14,441 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,441 INFO sqlalchemy.engine.Engine [cached since 0.0007889s ago] ('applicationstatus', 'pg_catalog')
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine [cached since 0.001278s ago] ('contactstatus', 'pg_catalog')
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine [cached since 0.001723s ago] ('rejectionreason', 'pg_catalog')
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine [cached since 0.002216s ago] ('blacklistreason', 'pg_catalog')
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine [cached since 0.002747s ago] ('blocktype', 'pg_catalog')
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine [cached since 0.003207s ago] ('documenttype', 'pg_catalog')
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine [cached since 0.00359s ago] ('paymentmethod', 'pg_catalog')
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine [cached since 0.003967s ago] ('paymentstatus', 'pg_catalog')
2026-02-12 17:21:14,445 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
2026-02-12 17:21:55,022 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,049 INFO sqlalchemy.engine.Engine SELECT blacklist.id, blacklist.phone, blacklist.reason, blacklist.reason_note, blacklist.strike_count, blacklist.block_type, blacklist.blocked_until, blacklist.added_by, blacklist.created_at, blacklist.updated_at 
FROM blacklist 
WHERE blacklist.phone = $1::VARCHAR
2026-02-12 17:21:55,049 INFO sqlalchemy.engine.Engine [generated in 0.00019s] ('+998903333333',)
2026-02-12 17:21:55,062 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-12 17:21:55,062 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('+998903333333',)
2026-02-12 17:21:55,255 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:21:55,255 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('683d6ef3-ef44-453d-b892-4f94d3aa8080'), None, None, 'user_login', 'user', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'null', 'null', None, 'null', datetime.datetime(2026, 2, 12, 12, 21, 55, 255432))
2026-02-12 17:21:55,258 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
2026-02-12 17:21:55,271 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,272 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:55,272 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:55,273 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:21:55,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,289 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:55,289 INFO sqlalchemy.engine.Engine [cached since 0.01748s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:55,291 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:21:55,291 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:21:55,297 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine [cached since 0.02615s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:21:55,299 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:21:55,299 INFO sqlalchemy.engine.Engine [generated in 0.00011s] ()
2026-02-12 17:21:55,301 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:21:55,301 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ()
2026-02-12 17:21:55,302 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:21:55,302 INFO sqlalchemy.engine.Engine [cached since 0.004279s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:21:55,303 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:21:55,303 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('CANCELLED',)
2026-02-12 17:21:55,304 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:21:55,304 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (5,)
2026-02-12 17:21:55,307 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:21:55,307 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ()
2026-02-12 17:21:55,308 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:21:55,308 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ()
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:55,314 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:21:55,314 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:21:55,323 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:21:55,331 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:55,331 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:21:55,340 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61165 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:21:57,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,310 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine [cached since 2.039s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine [cached since 2.039s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:57,313 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:57,314 INFO sqlalchemy.engine.Engine [generated in 0.00020s] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:57,316 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:21:57,316 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:21:57,316 INFO sqlalchemy.engine.Engine [cached since 2.002s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
INFO:     127.0.0.1:61163 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:21:57,322 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:57,322 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:21:57,323 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,324 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:21:57,324 INFO sqlalchemy.engine.Engine [generated in 0.00014s] ('markup_percent',)
2026-02-12 17:21:57,324 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,325 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:57,325 INFO sqlalchemy.engine.Engine [cached since 2.053s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:57,326 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:57,326 INFO sqlalchemy.engine.Engine [cached since 0.01253s ago] ('MANAGER', 100, 0)
2026-02-12 17:21:57,327 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:21:57,329 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:21:57,329 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ()
2026-02-12 17:21:57,331 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61165 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:21:57,333 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:21:57,333 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (50, 0)
2026-02-12 17:21:57,334 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61176 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:22:02,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:02,296 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:02,296 INFO sqlalchemy.engine.Engine [cached since 7.025s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:02,298 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:22:02,298 INFO sqlalchemy.engine.Engine [generated in 0.00018s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,301 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 17:22:02,301 INFO sqlalchemy.engine.Engine [generated in 0.00019s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,302 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61176 - "GET /api/v1/applications/4e61a4e0-59e3-4046-b2a9-8741eeb4e272/comments HTTP/1.1" 200 OK
2026-02-12 17:22:02,312 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:02,312 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:02,312 INFO sqlalchemy.engine.Engine [cached since 7.04s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:22:02,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:02,313 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:02,313 INFO sqlalchemy.engine.Engine [cached since 7.041s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:02,314 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:22:02,314 INFO sqlalchemy.engine.Engine [cached since 0.01568s ago] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,316 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:22:02,316 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'), 'VIDEO_SIGNATURE')
2026-02-12 17:22:02,326 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61176 - "GET /api/v1/documents/applications/4e61a4e0-59e3-4046-b2a9-8741eeb4e272/documents HTTP/1.1" 200 OK
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:02,328 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:22:02,328 INFO sqlalchemy.engine.Engine [cached since 0.03018s ago] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,334 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:22:02,334 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'), 'VIDEO_SIGNATURE')
2026-02-12 17:22:02,340 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61165 - "GET /api/v1/documents/applications/4e61a4e0-59e3-4046-b2a9-8741eeb4e272/videos HTTP/1.1" 200 OK
2026-02-12 17:22:58,040 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,041 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:58,041 INFO sqlalchemy.engine.Engine [cached since 62.77s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:22:58,042 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,042 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:58,043 INFO sqlalchemy.engine.Engine [cached since 62.77s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:58,044 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:22:58,044 INFO sqlalchemy.engine.Engine [cached since 60.73s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine [cached since 60.72s ago] ('markup_percent',)
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:22:58,046 INFO sqlalchemy.engine.Engine [cached since 62.73s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:22:58,046 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:22:58,046 INFO sqlalchemy.engine.Engine [cached since 60.71s ago] ()
2026-02-12 17:22:58,047 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:22:58,047 INFO sqlalchemy.engine.Engine [cached since 60.72s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:22:58,048 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:22:58,048 INFO sqlalchemy.engine.Engine [generated in 0.00009s] (50, 0)
2026-02-12 17:22:58,050 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61473 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:22:58,068 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61472 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:22:58,071 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,072 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:58,072 INFO sqlalchemy.engine.Engine [cached since 62.8s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:58,073 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:22:58,073 INFO sqlalchemy.engine.Engine [cached since 60.76s ago] ('MANAGER', 100, 0)
2026-02-12 17:22:58,094 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61471 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:22:58,096 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61472 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:23:12,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine [cached since 77.06s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine [cached since 77.06s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:23:12,334 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,334 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:23:12,334 INFO sqlalchemy.engine.Engine [cached since 75.01s ago] ('markup_percent',)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:23:12,338 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:23:12,338 INFO sqlalchemy.engine.Engine [cached since 75.02s ago] ('OPERATOR', 100, 0)
2026-02-12 17:23:12,339 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:23:12,340 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:23:12,340 INFO sqlalchemy.engine.Engine [cached since 77.02s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
INFO:     127.0.0.1:61555 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:23:12,345 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,345 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:23:12,345 INFO sqlalchemy.engine.Engine [cached since 77.07s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:23:12,346 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:23:12,346 INFO sqlalchemy.engine.Engine [cached since 75.03s ago] ('MANAGER', 100, 0)
2026-02-12 17:23:12,347 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61555 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:23:12,352 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:23:12,352 INFO sqlalchemy.engine.Engine [cached since 75.03s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:23:12,361 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:23:12,362 INFO sqlalchemy.engine.Engine [cached since 75.03s ago] ()
2026-02-12 17:23:12,362 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:23:12,362 INFO sqlalchemy.engine.Engine [cached since 14.31s ago] (50, 0)
2026-02-12 17:23:12,374 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:23:12,376 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61556 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61554 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/auth/login HTTP/1.1" 200 OK
2026-02-12 17:36:59,111 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,112 INFO sqlalchemy.engine.Engine SELECT blacklist.id, blacklist.phone, blacklist.reason, blacklist.reason_note, blacklist.strike_count, blacklist.block_type, blacklist.blocked_until, blacklist.added_by, blacklist.created_at, blacklist.updated_at 
FROM blacklist 
WHERE blacklist.phone = $1::VARCHAR
2026-02-12 17:36:59,113 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('+998902222222',)
2026-02-12 17:36:59,124 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-12 17:36:59,124 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('+998902222222',)
2026-02-12 17:36:59,323 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:36:59,323 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('6f9fe9ec-3de2-4e9d-9f2d-231a03455216'), None, None, 'user_login', 'user', UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 'null', 'null', None, 'null', datetime.datetime(2026, 2, 12, 12, 36, 59, 323226))
2026-02-12 17:36:59,325 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65408 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:36:59,331 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,331 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:36:59,331 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:36:59,332 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65410 - "GET /api/v1/users/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:65410 - "OPTIONS /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:36:59,391 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,391 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:36:59,391 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:36:59,394 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:36:59,396 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:36:59,396 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:36:59,399 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:36:59,399 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
2026-02-12 17:36:59,402 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:36:59,402 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:36:59,402 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
INFO:     127.0.0.1:65408 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('CANCELLED',)
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (5,)
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
2026-02-12 17:36:59,405 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:36:59,405 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
2026-02-12 17:36:59,405 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65410 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:65410 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:65413 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine [cached since 905.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine [cached since 905.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:37:01,207 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ('markup_percent',)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:37:01,208 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,208 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ('OPERATOR', 100, 0)
2026-02-12 17:37:01,209 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:37:01,209 INFO sqlalchemy.engine.Engine [cached since 1.815s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,210 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65413 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:37:01,215 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,215 INFO sqlalchemy.engine.Engine [generated in 0.00019s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:37:01,216 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:37:01,216 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ()
INFO:     127.0.0.1:65413 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:37:01,218 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:37:01,218 INFO sqlalchemy.engine.Engine [cached since 843.2s ago] (50, 0)
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine [cached since 906s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:65415 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:37:01,221 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:37:01,222 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,222 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ('MANAGER', 100, 0)
INFO:     127.0.0.1:65410 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:37:01,223 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65408 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:37:01,979 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,979 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,979 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,980 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,980 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,980 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:37:01,982 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:37:01,982 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:37:01,983 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:37:01,983 INFO sqlalchemy.engine.Engine [cached since 2.588s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,984 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:37:01,985 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:37:01,985 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,985 INFO sqlalchemy.engine.Engine [cached since 0.7702s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:37:01,987 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:37:01,987 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,988 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:37:01,988 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,989 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:37:01,990 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:37:01,990 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:65410 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:37:01,991 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:37:01,991 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ('CANCELLED',)
2026-02-12 17:37:01,992 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:37:01,992 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (5,)
2026-02-12 17:37:01,995 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:37:01,995 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,996 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:37:01,996 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,997 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65408 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:38:41,616 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:38:41,616 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:38:41,620 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:38:41,620 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:38:41,620 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:38:41,621 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:38:41,621 INFO sqlalchemy.engine.Engine [cached since 102.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:49516 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine [cached since 100.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:38:41,623 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:38:41,623 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,624 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49515 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:38:41,624 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:38:41,624 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,625 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:38:41,625 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ('CANCELLED',)
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (5,)
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,631 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49514 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine [cached since 1033s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine [cached since 129.4s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine [cached since 127.6s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
INFO:     127.0.0.1:49655 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:39:08,663 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:39:08,663 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:08,663 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:08,664 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:39:08,664 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:49654 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('CANCELLED',)
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine [cached since 1033s ago] (5,)
2026-02-12 17:39:08,666 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:39:08,666 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:08,667 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:39:08,667 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:08,667 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49653 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:49653 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49654 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49655 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49653 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,614 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,614 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:10,614 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:10,615 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:10,615 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('OPERATOR', 100, 0)
INFO:     127.0.0.1:49655 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:39:10,616 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:10,616 INFO sqlalchemy.engine.Engine [cached since 131.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:10,616 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:10,617 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:10,617 INFO sqlalchemy.engine.Engine [cached since 129.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:10,625 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49654 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:10,629 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,629 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,629 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:10,630 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:10,630 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('MANAGER', 100, 0)
2026-02-12 17:39:10,630 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:10,632 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,632 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:39:10,632 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('markup_percent',)
2026-02-12 17:39:10,634 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:39:10,634 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:10,637 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:39:10,637 INFO sqlalchemy.engine.Engine [cached since 972.7s ago] (50, 0)
2026-02-12 17:39:10,639 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49675 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49675 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
2026-02-12 17:39:14,079 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:14,080 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:14,080 INFO sqlalchemy.engine.Engine [cached since 1039s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:14,081 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:14,081 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:14,082 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 17:39:14,082 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:14,086 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
INFO:     127.0.0.1:49674 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:49675 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 17:39:14,095 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine [cached since 1039s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine [cached since 1039s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:14,097 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:14,097 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:14,098 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:14,098 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 17:39:14,100 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 17:39:14,105 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:49654 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/checklist HTTP/1.1" 200 OK
2026-02-12 17:39:15,865 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:15,866 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:15,866 INFO sqlalchemy.engine.Engine [cached since 1041s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:15,886 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:15,887 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:15,900 INFO sqlalchemy.engine.Engine UPDATE applications SET checklist=$1::JSON, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 17:39:15,900 INFO sqlalchemy.engine.Engine [generated in 0.00080s] ('{"agreed_visit": true, "documents": false}', datetime.datetime(2026, 2, 12, 12, 39, 15, 900090), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 17:39:15,903 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:15,907 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:15,909 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:15,909 INFO sqlalchemy.engine.Engine [generated in 0.00022s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:15,912 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/checklist HTTP/1.1" 200 OK
INFO:     127.0.0.1:49674 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 17:39:17,598 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:17,599 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:17,599 INFO sqlalchemy.engine.Engine [cached since 1042s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:17,600 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:17,600 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:17,601 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 17:39:17,601 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('CONFIRMED', datetime.datetime(2026, 2, 12, 12, 39, 17, 601472), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 17:39:17,602 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:39:17,602 INFO sqlalchemy.engine.Engine [cached since 1042s ago] (UUID('7997faea-e039-48b9-9819-4f18b016eb5e'), UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), None, 'application_status_changed', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), '{"status": "new"}', '{"status": "confirmed", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 12, 39, 17, 602878))
2026-02-12 17:39:17,605 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:39:17,605 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('34e8fdf3-fcb7-4ab1-b266-beb2e3eb0233'), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'NEW', 'CONFIRMED', UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), '', datetime.datetime(2026, 2, 12, 12, 39, 17, 605684))
2026-02-12 17:39:17,607 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:17,608 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:17,608 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:17,608 INFO sqlalchemy.engine.Engine [cached since 1.699s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:17,609 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 17:39:17,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:17,613 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:17,613 INFO sqlalchemy.engine.Engine [cached since 1042s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:17,615 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:17,615 INFO sqlalchemy.engine.Engine [cached since 138.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:17,616 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:17,616 INFO sqlalchemy.engine.Engine [cached since 136.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:17,619 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49677 - "OPTIONS /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:49702 - "OPTIONS /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:39:30,094 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:30,098 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:39:30,098 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine [cached since 150.8s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine [cached since 149s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,101 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:39:30,101 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ('CANCELLED',)
INFO:     127.0.0.1:49702 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:39:30,103 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:39:30,103 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (5,)
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,105 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49677 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:39:31,481 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine [cached since 1056s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine [cached since 1056s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:31,484 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:31,484 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ('OPERATOR', 100, 0)
2026-02-12 17:39:31,485 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,485 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:39:31,485 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ('markup_percent',)
2026-02-12 17:39:31,486 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:31,486 INFO sqlalchemy.engine.Engine [cached since 152.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:31,487 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ()
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine [cached since 150.4s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
INFO:     127.0.0.1:49702 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:31,489 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:39:31,489 INFO sqlalchemy.engine.Engine [cached since 993.6s ago] (50, 0)
2026-02-12 17:39:31,490 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:31,491 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49677 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49704 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:39:31,493 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,493 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:31,493 INFO sqlalchemy.engine.Engine [cached since 1056s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:31,495 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:31,495 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ('MANAGER', 100, 0)
2026-02-12 17:39:31,496 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49702 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
