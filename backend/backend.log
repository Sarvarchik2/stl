INFO:     Will watch for changes in these directories: ['/Users/ula/Desktop/stl-admin/backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [33064] using WatchFiles
INFO:     Started server process [33107]
INFO:     Waiting for application startup.
2026-02-12 17:21:14,429 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-12 17:21:14,429 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:21:14,430 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-12 17:21:14,430 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:21:14,431 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-12 17:21:14,431 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:21:14,431 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:14,433 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,433 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,436 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,436 INFO sqlalchemy.engine.Engine [cached since 0.00354s ago] ('cars_catalog', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine [cached since 0.004s ago] ('cars_price_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,437 INFO sqlalchemy.engine.Engine [cached since 0.004412s ago] ('applications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine [cached since 0.004813s ago] ('application_status_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine [cached since 0.005183s ago] ('application_comments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,438 INFO sqlalchemy.engine.Engine [cached since 0.005558s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.005827s ago] ('settings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.006061s ago] ('blacklist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.006283s ago] ('documents', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,439 INFO sqlalchemy.engine.Engine [cached since 0.006495s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine [cached since 0.006705s ago] ('stories', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine [cached since 0.006919s ago] ('story_slides', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:21:14,440 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,441 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('role', 'pg_catalog')
2026-02-12 17:21:14,441 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,441 INFO sqlalchemy.engine.Engine [cached since 0.0007889s ago] ('applicationstatus', 'pg_catalog')
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine [cached since 0.001278s ago] ('contactstatus', 'pg_catalog')
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,442 INFO sqlalchemy.engine.Engine [cached since 0.001723s ago] ('rejectionreason', 'pg_catalog')
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine [cached since 0.002216s ago] ('blacklistreason', 'pg_catalog')
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,443 INFO sqlalchemy.engine.Engine [cached since 0.002747s ago] ('blocktype', 'pg_catalog')
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine [cached since 0.003207s ago] ('documenttype', 'pg_catalog')
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine [cached since 0.00359s ago] ('paymentmethod', 'pg_catalog')
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:21:14,444 INFO sqlalchemy.engine.Engine [cached since 0.003967s ago] ('paymentstatus', 'pg_catalog')
2026-02-12 17:21:14,445 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
2026-02-12 17:21:55,022 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,049 INFO sqlalchemy.engine.Engine SELECT blacklist.id, blacklist.phone, blacklist.reason, blacklist.reason_note, blacklist.strike_count, blacklist.block_type, blacklist.blocked_until, blacklist.added_by, blacklist.created_at, blacklist.updated_at 
FROM blacklist 
WHERE blacklist.phone = $1::VARCHAR
2026-02-12 17:21:55,049 INFO sqlalchemy.engine.Engine [generated in 0.00019s] ('+998903333333',)
2026-02-12 17:21:55,062 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-12 17:21:55,062 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('+998903333333',)
2026-02-12 17:21:55,255 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:21:55,255 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('683d6ef3-ef44-453d-b892-4f94d3aa8080'), None, None, 'user_login', 'user', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'null', 'null', None, 'null', datetime.datetime(2026, 2, 12, 12, 21, 55, 255432))
2026-02-12 17:21:55,258 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
2026-02-12 17:21:55,271 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,272 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:55,272 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:55,273 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:21:55,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,289 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:55,289 INFO sqlalchemy.engine.Engine [cached since 0.01748s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:55,291 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:21:55,291 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:21:55,297 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:55,298 INFO sqlalchemy.engine.Engine [cached since 0.02615s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:21:55,299 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:21:55,299 INFO sqlalchemy.engine.Engine [generated in 0.00011s] ()
2026-02-12 17:21:55,301 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:21:55,301 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ()
2026-02-12 17:21:55,302 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:21:55,302 INFO sqlalchemy.engine.Engine [cached since 0.004279s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:21:55,303 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:21:55,303 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('CANCELLED',)
2026-02-12 17:21:55,304 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:21:55,304 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (5,)
2026-02-12 17:21:55,307 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:21:55,307 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ()
2026-02-12 17:21:55,308 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:21:55,308 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ()
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:55,314 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:21:55,314 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:21:55,323 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:21:55,331 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:55,331 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:21:55,340 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61165 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:21:57,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,310 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine [cached since 2.039s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:57,311 INFO sqlalchemy.engine.Engine [cached since 2.039s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:57,313 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:57,314 INFO sqlalchemy.engine.Engine [generated in 0.00020s] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:57,316 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:21:57,316 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:21:57,316 INFO sqlalchemy.engine.Engine [cached since 2.002s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
INFO:     127.0.0.1:61163 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:21:57,322 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:57,322 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:21:57,323 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,324 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:21:57,324 INFO sqlalchemy.engine.Engine [generated in 0.00014s] ('markup_percent',)
2026-02-12 17:21:57,324 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:21:57,325 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:21:57,325 INFO sqlalchemy.engine.Engine [cached since 2.053s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:21:57,326 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:21:57,326 INFO sqlalchemy.engine.Engine [cached since 0.01253s ago] ('MANAGER', 100, 0)
2026-02-12 17:21:57,327 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:21:57,329 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:21:57,329 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ()
2026-02-12 17:21:57,331 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61163 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61165 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:21:57,333 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:21:57,333 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (50, 0)
2026-02-12 17:21:57,334 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61176 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:22:02,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:02,296 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:02,296 INFO sqlalchemy.engine.Engine [cached since 7.025s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:02,298 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:22:02,298 INFO sqlalchemy.engine.Engine [generated in 0.00018s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,301 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 17:22:02,301 INFO sqlalchemy.engine.Engine [generated in 0.00019s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,302 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61176 - "GET /api/v1/applications/4e61a4e0-59e3-4046-b2a9-8741eeb4e272/comments HTTP/1.1" 200 OK
2026-02-12 17:22:02,312 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:02,312 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:02,312 INFO sqlalchemy.engine.Engine [cached since 7.04s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:22:02,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:02,313 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:02,313 INFO sqlalchemy.engine.Engine [cached since 7.041s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:02,314 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:22:02,314 INFO sqlalchemy.engine.Engine [cached since 0.01568s ago] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,316 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:22:02,316 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'), 'VIDEO_SIGNATURE')
2026-02-12 17:22:02,326 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61176 - "GET /api/v1/documents/applications/4e61a4e0-59e3-4046-b2a9-8741eeb4e272/documents HTTP/1.1" 200 OK
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:02,328 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:22:02,328 INFO sqlalchemy.engine.Engine [cached since 0.03018s ago] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'),)
2026-02-12 17:22:02,334 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:22:02,334 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('4e61a4e0-59e3-4046-b2a9-8741eeb4e272'), 'VIDEO_SIGNATURE')
2026-02-12 17:22:02,340 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61165 - "GET /api/v1/documents/applications/4e61a4e0-59e3-4046-b2a9-8741eeb4e272/videos HTTP/1.1" 200 OK
2026-02-12 17:22:58,040 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,041 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:58,041 INFO sqlalchemy.engine.Engine [cached since 62.77s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:22:58,042 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,042 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:58,043 INFO sqlalchemy.engine.Engine [cached since 62.77s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:58,044 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:22:58,044 INFO sqlalchemy.engine.Engine [cached since 60.73s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine [cached since 60.72s ago] ('markup_percent',)
2026-02-12 17:22:58,045 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:22:58,046 INFO sqlalchemy.engine.Engine [cached since 62.73s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:22:58,046 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:22:58,046 INFO sqlalchemy.engine.Engine [cached since 60.71s ago] ()
2026-02-12 17:22:58,047 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:22:58,047 INFO sqlalchemy.engine.Engine [cached since 60.72s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:22:58,048 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:22:58,048 INFO sqlalchemy.engine.Engine [generated in 0.00009s] (50, 0)
2026-02-12 17:22:58,050 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61473 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:22:58,068 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61472 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:22:58,071 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:22:58,072 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:22:58,072 INFO sqlalchemy.engine.Engine [cached since 62.8s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:22:58,073 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:22:58,073 INFO sqlalchemy.engine.Engine [cached since 60.76s ago] ('MANAGER', 100, 0)
2026-02-12 17:22:58,094 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61471 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:22:58,096 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61472 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:23:12,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine [cached since 77.06s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:23:12,333 INFO sqlalchemy.engine.Engine [cached since 77.06s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 17:23:12,334 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,334 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:23:12,334 INFO sqlalchemy.engine.Engine [cached since 75.01s ago] ('markup_percent',)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:23:12,338 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:23:12,338 INFO sqlalchemy.engine.Engine [cached since 75.02s ago] ('OPERATOR', 100, 0)
2026-02-12 17:23:12,339 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:23:12,340 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:23:12,340 INFO sqlalchemy.engine.Engine [cached since 77.02s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
INFO:     127.0.0.1:61555 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:23:12,345 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:23:12,345 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:23:12,345 INFO sqlalchemy.engine.Engine [cached since 77.07s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 17:23:12,346 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:23:12,346 INFO sqlalchemy.engine.Engine [cached since 75.03s ago] ('MANAGER', 100, 0)
2026-02-12 17:23:12,347 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61555 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:23:12,352 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:23:12,352 INFO sqlalchemy.engine.Engine [cached since 75.03s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 17:23:12,361 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:23:12,362 INFO sqlalchemy.engine.Engine [cached since 75.03s ago] ()
2026-02-12 17:23:12,362 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:23:12,362 INFO sqlalchemy.engine.Engine [cached since 14.31s ago] (50, 0)
2026-02-12 17:23:12,374 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:23:12,376 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:61556 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61554 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/auth/login HTTP/1.1" 200 OK
2026-02-12 17:36:59,111 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,112 INFO sqlalchemy.engine.Engine SELECT blacklist.id, blacklist.phone, blacklist.reason, blacklist.reason_note, blacklist.strike_count, blacklist.block_type, blacklist.blocked_until, blacklist.added_by, blacklist.created_at, blacklist.updated_at 
FROM blacklist 
WHERE blacklist.phone = $1::VARCHAR
2026-02-12 17:36:59,113 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('+998902222222',)
2026-02-12 17:36:59,124 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-12 17:36:59,124 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('+998902222222',)
2026-02-12 17:36:59,323 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:36:59,323 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('6f9fe9ec-3de2-4e9d-9f2d-231a03455216'), None, None, 'user_login', 'user', UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 'null', 'null', None, 'null', datetime.datetime(2026, 2, 12, 12, 36, 59, 323226))
2026-02-12 17:36:59,325 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65408 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:36:59,331 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,331 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:36:59,331 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:36:59,332 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65410 - "GET /api/v1/users/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:65410 - "OPTIONS /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:36:59,391 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,391 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:36:59,391 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:36:59,394 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:36:59,395 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:36:59,396 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:36:59,396 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:36:59,399 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:36:59,399 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:36:59,400 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
2026-02-12 17:36:59,402 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:36:59,402 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:36:59,402 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
INFO:     127.0.0.1:65408 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:36:59,403 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ('CANCELLED',)
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] (5,)
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:36:59,404 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
2026-02-12 17:36:59,405 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:36:59,405 INFO sqlalchemy.engine.Engine [cached since 904.1s ago] ()
2026-02-12 17:36:59,405 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65410 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:65410 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:65408 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:65413 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine [cached since 905.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,205 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine [cached since 905.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,206 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:37:01,207 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ('markup_percent',)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:37:01,208 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,208 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ('OPERATOR', 100, 0)
2026-02-12 17:37:01,209 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:37:01,209 INFO sqlalchemy.engine.Engine [cached since 1.815s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,210 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65413 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:37:01,215 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,215 INFO sqlalchemy.engine.Engine [generated in 0.00019s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:37:01,216 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:37:01,216 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ()
INFO:     127.0.0.1:65413 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:37:01,218 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:37:01,218 INFO sqlalchemy.engine.Engine [cached since 843.2s ago] (50, 0)
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,220 INFO sqlalchemy.engine.Engine [cached since 906s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:65415 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:37:01,221 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:37:01,222 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,222 INFO sqlalchemy.engine.Engine [cached since 903.9s ago] ('MANAGER', 100, 0)
INFO:     127.0.0.1:65410 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:37:01,223 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65408 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:37:01,979 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,979 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,979 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,980 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:37:01,980 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:37:01,980 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:37:01,982 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:37:01,982 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:37:01,983 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:37:01,983 INFO sqlalchemy.engine.Engine [cached since 2.588s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:37:01,984 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:37:01,985 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:37:01,985 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:37:01,985 INFO sqlalchemy.engine.Engine [cached since 0.7702s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:37:01,987 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:37:01,987 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,988 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:37:01,988 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,989 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:37:01,990 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:37:01,990 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:65410 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:37:01,991 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:37:01,991 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ('CANCELLED',)
2026-02-12 17:37:01,992 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:37:01,992 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] (5,)
2026-02-12 17:37:01,995 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:37:01,995 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,996 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:37:01,996 INFO sqlalchemy.engine.Engine [cached since 906.7s ago] ()
2026-02-12 17:37:01,997 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:65408 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:38:41,616 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:38:41,616 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:38:41,617 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:38:41,620 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:38:41,620 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:38:41,620 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:38:41,621 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:38:41,621 INFO sqlalchemy.engine.Engine [cached since 102.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:49516 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine [cached since 100.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:38:41,622 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:38:41,623 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:38:41,623 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,624 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49515 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:38:41,624 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:38:41,624 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,625 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:38:41,625 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ('CANCELLED',)
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:38:41,626 INFO sqlalchemy.engine.Engine [cached since 1006s ago] (5,)
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:38:41,630 INFO sqlalchemy.engine.Engine [cached since 1006s ago] ()
2026-02-12 17:38:41,631 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49514 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:08,659 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:08,660 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine [cached since 1033s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine [cached since 129.4s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:08,661 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine [cached since 127.6s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:39:08,662 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
INFO:     127.0.0.1:49655 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:39:08,663 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:39:08,663 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:08,663 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:08,664 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:39:08,664 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:49654 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('CANCELLED',)
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:39:08,665 INFO sqlalchemy.engine.Engine [cached since 1033s ago] (5,)
2026-02-12 17:39:08,666 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:39:08,666 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:08,667 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:39:08,667 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:08,667 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49653 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:49653 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49654 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49655 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49653 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:10,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,614 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,614 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:10,614 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:10,615 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:10,615 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('OPERATOR', 100, 0)
INFO:     127.0.0.1:49655 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:39:10,616 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:10,616 INFO sqlalchemy.engine.Engine [cached since 131.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:10,616 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:10,617 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:10,617 INFO sqlalchemy.engine.Engine [cached since 129.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:10,625 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49654 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:10,629 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,629 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:10,629 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:10,630 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:10,630 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('MANAGER', 100, 0)
2026-02-12 17:39:10,630 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:10,632 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:10,632 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:39:10,632 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ('markup_percent',)
2026-02-12 17:39:10,634 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:39:10,634 INFO sqlalchemy.engine.Engine [cached since 1033s ago] ()
2026-02-12 17:39:10,637 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:39:10,637 INFO sqlalchemy.engine.Engine [cached since 972.7s ago] (50, 0)
2026-02-12 17:39:10,639 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49675 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49675 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
2026-02-12 17:39:14,079 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:14,080 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:14,080 INFO sqlalchemy.engine.Engine [cached since 1039s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:14,081 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:14,081 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:14,082 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 17:39:14,082 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:14,086 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
INFO:     127.0.0.1:49674 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:49675 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 17:39:14,095 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine [cached since 1039s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:14,096 INFO sqlalchemy.engine.Engine [cached since 1039s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:14,097 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:14,097 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:14,098 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:14,098 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 17:39:14,099 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 17:39:14,100 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 17:39:14,105 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:49654 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/checklist HTTP/1.1" 200 OK
2026-02-12 17:39:15,865 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:15,866 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:15,866 INFO sqlalchemy.engine.Engine [cached since 1041s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:15,886 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:15,887 INFO sqlalchemy.engine.Engine [cached since 1034s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:15,900 INFO sqlalchemy.engine.Engine UPDATE applications SET checklist=$1::JSON, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 17:39:15,900 INFO sqlalchemy.engine.Engine [generated in 0.00080s] ('{"agreed_visit": true, "documents": false}', datetime.datetime(2026, 2, 12, 12, 39, 15, 900090), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 17:39:15,903 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:15,907 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:15,909 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:15,909 INFO sqlalchemy.engine.Engine [generated in 0.00022s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:15,912 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49674 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/checklist HTTP/1.1" 200 OK
INFO:     127.0.0.1:49674 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 17:39:17,598 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:17,599 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:17,599 INFO sqlalchemy.engine.Engine [cached since 1042s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:17,600 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:17,600 INFO sqlalchemy.engine.Engine [cached since 1035s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:17,601 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 17:39:17,601 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ('CONFIRMED', datetime.datetime(2026, 2, 12, 12, 39, 17, 601472), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 17:39:17,602 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:39:17,602 INFO sqlalchemy.engine.Engine [cached since 1042s ago] (UUID('7997faea-e039-48b9-9819-4f18b016eb5e'), UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), None, 'application_status_changed', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), '{"status": "new"}', '{"status": "confirmed", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 12, 39, 17, 602878))
2026-02-12 17:39:17,605 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 17:39:17,605 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('34e8fdf3-fcb7-4ab1-b266-beb2e3eb0233'), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'NEW', 'CONFIRMED', UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), '', datetime.datetime(2026, 2, 12, 12, 39, 17, 605684))
2026-02-12 17:39:17,607 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:17,608 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:17,608 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 17:39:17,608 INFO sqlalchemy.engine.Engine [cached since 1.699s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 17:39:17,609 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 17:39:17,613 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:17,613 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:17,613 INFO sqlalchemy.engine.Engine [cached since 1042s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:17,615 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:17,615 INFO sqlalchemy.engine.Engine [cached since 138.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:17,616 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:17,616 INFO sqlalchemy.engine.Engine [cached since 136.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:17,619 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49654 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49677 - "OPTIONS /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:49702 - "OPTIONS /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:39:30,094 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:30,095 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:30,098 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:39:30,098 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine [cached since 150.8s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:39:30,099 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine [cached since 149s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:39:30,100 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,101 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:39:30,101 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:39:30,102 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ('CANCELLED',)
INFO:     127.0.0.1:49702 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:39:30,103 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:39:30,103 INFO sqlalchemy.engine.Engine [cached since 1055s ago] (5,)
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:39:30,104 INFO sqlalchemy.engine.Engine [cached since 1055s ago] ()
2026-02-12 17:39:30,105 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49677 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:39:31,481 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine [cached since 1056s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:31,482 INFO sqlalchemy.engine.Engine [cached since 1056s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:31,484 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:31,484 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ('OPERATOR', 100, 0)
2026-02-12 17:39:31,485 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,485 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:39:31,485 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ('markup_percent',)
2026-02-12 17:39:31,486 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:39:31,486 INFO sqlalchemy.engine.Engine [cached since 152.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:39:31,487 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ()
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:31,488 INFO sqlalchemy.engine.Engine [cached since 150.4s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
INFO:     127.0.0.1:49702 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:39:31,489 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:39:31,489 INFO sqlalchemy.engine.Engine [cached since 993.6s ago] (50, 0)
2026-02-12 17:39:31,490 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:39:31,491 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49677 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:49704 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:39:31,493 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:39:31,493 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:39:31,493 INFO sqlalchemy.engine.Engine [cached since 1056s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:39:31,495 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:39:31,495 INFO sqlalchemy.engine.Engine [cached since 1054s ago] ('MANAGER', 100, 0)
2026-02-12 17:39:31,496 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49702 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/api/admin.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [33107]
INFO:     Started server process [34493]
INFO:     Waiting for application startup.
2026-02-12 17:41:45,670 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-12 17:41:45,670 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:41:45,671 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-12 17:41:45,671 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:41:45,671 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-12 17:41:45,671 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 17:41:45,672 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:41:45,673 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,673 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,677 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,677 INFO sqlalchemy.engine.Engine [cached since 0.004024s ago] ('cars_catalog', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,678 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,678 INFO sqlalchemy.engine.Engine [cached since 0.004351s ago] ('cars_price_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,678 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,678 INFO sqlalchemy.engine.Engine [cached since 0.004717s ago] ('applications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,678 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,678 INFO sqlalchemy.engine.Engine [cached since 0.005029s ago] ('application_status_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine [cached since 0.005292s ago] ('application_comments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine [cached since 0.00555s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine [cached since 0.005725s ago] ('settings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine [cached since 0.005899s ago] ('blacklist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,679 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine [cached since 0.006106s ago] ('documents', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine [cached since 0.006307s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine [cached since 0.006486s ago] ('stories', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 17:41:45,680 INFO sqlalchemy.engine.Engine [cached since 0.006656s ago] ('story_slides', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 17:41:45,681 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,681 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ('role', 'pg_catalog')
2026-02-12 17:41:45,684 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,684 INFO sqlalchemy.engine.Engine [cached since 0.00298s ago] ('applicationstatus', 'pg_catalog')
2026-02-12 17:41:45,684 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,684 INFO sqlalchemy.engine.Engine [cached since 0.00352s ago] ('contactstatus', 'pg_catalog')
2026-02-12 17:41:45,685 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,685 INFO sqlalchemy.engine.Engine [cached since 0.003992s ago] ('rejectionreason', 'pg_catalog')
2026-02-12 17:41:45,685 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,685 INFO sqlalchemy.engine.Engine [cached since 0.00442s ago] ('blacklistreason', 'pg_catalog')
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine [cached since 0.004763s ago] ('blocktype', 'pg_catalog')
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine [cached since 0.005108s ago] ('documenttype', 'pg_catalog')
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine [cached since 0.005375s ago] ('paymentmethod', 'pg_catalog')
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 17:41:45,686 INFO sqlalchemy.engine.Engine [cached since 0.005632s ago] ('paymentstatus', 'pg_catalog')
2026-02-12 17:41:45,687 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
2026-02-12 17:41:45,691 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:41:45,705 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:41:45,705 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:41:45,712 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:41:45,712 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:41:45,712 INFO sqlalchemy.engine.Engine [cached since 0.006566s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:41:45,721 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:41:45,722 INFO sqlalchemy.engine.Engine [generated in 0.00012s] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:41:45,730 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:41:45,730 INFO sqlalchemy.engine.Engine [generated in 0.00007s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:41:45,730 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:41:45,730 INFO sqlalchemy.engine.Engine [generated in 0.00008s] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:41:45,731 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:41:45,731 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ()
2026-02-12 17:41:45,734 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:41:45,734 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:41:45,735 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:41:45,735 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ()
2026-02-12 17:41:45,736 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:41:45,736 INFO sqlalchemy.engine.Engine [cached since 0.00548s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:41:45,736 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:41:45,736 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ('CANCELLED',)
2026-02-12 17:41:45,737 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:41:45,737 INFO sqlalchemy.engine.Engine [generated in 0.00004s] (5,)
2026-02-12 17:41:45,739 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:41:45,739 INFO sqlalchemy.engine.Engine [generated in 0.00003s] ()
2026-02-12 17:41:45,740 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49788 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:41:45,741 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:41:45,741 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ()
2026-02-12 17:41:45,745 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.operator_id = $1::UUID AND (applications.status NOT IN ($2::applicationstatus, $3::applicationstatus))
2026-02-12 17:41:45,745 INFO sqlalchemy.engine.Engine [generated in 0.00007s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 'NEW', 'CANCELLED')
2026-02-12 17:41:45,746 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49787 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 17:44:22,222 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:22,223 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:22,223 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:22,223 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:22,223 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:22,223 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:22,226 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:44:22,226 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 17:44:22,227 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:44:22,227 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:22,228 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:44:22,228 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:44:22,232 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:22,232 INFO sqlalchemy.engine.Engine [generated in 0.00012s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:44:22,233 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:44:22,233 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ()
2026-02-12 17:44:22,233 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:22,234 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:22,234 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:22,234 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:44:22,234 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ()
2026-02-12 17:44:22,235 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:44:22,235 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:44:22,236 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:44:22,236 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ('CANCELLED',)
2026-02-12 17:44:22,236 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:44:22,236 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (5,)
2026-02-12 17:44:22,238 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:44:22,238 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ()
2026-02-12 17:44:22,239 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:44:22,239 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] ()
2026-02-12 17:44:22,241 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:44:22,241 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.operator_id = $1::UUID AND (applications.status NOT IN ($2::applicationstatus, $3::applicationstatus))
2026-02-12 17:44:22,241 INFO sqlalchemy.engine.Engine [cached since 156.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 'NEW', 'CANCELLED')
INFO:     127.0.0.1:49909 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:44:22,243 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49908 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:22,245 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49910 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:44:23,254 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:23,254 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:23,254 INFO sqlalchemy.engine.Engine [cached since 157.6s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:23,255 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:23,255 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:23,255 INFO sqlalchemy.engine.Engine [cached since 157.6s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:23,258 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:23,258 INFO sqlalchemy.engine.Engine [generated in 0.00021s] ('OPERATOR', 100, 0)
2026-02-12 17:44:23,259 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:44:23,259 INFO sqlalchemy.engine.Engine [cached since 157.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:23,260 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:23,260 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:44:23,260 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('markup_percent',)
2026-02-12 17:44:23,261 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:23,261 INFO sqlalchemy.engine.Engine [cached since 1.029s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:44:23,262 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:44:23,263 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49908 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:49910 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:44:23,265 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:44:23,266 INFO sqlalchemy.engine.Engine [generated in 0.00011s] ()
2026-02-12 17:44:23,267 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:23,267 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:23,267 INFO sqlalchemy.engine.Engine [cached since 157.6s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:23,268 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:23,268 INFO sqlalchemy.engine.Engine [cached since 0.01023s ago] ('MANAGER', 100, 0)
2026-02-12 17:44:23,270 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:44:23,270 INFO sqlalchemy.engine.Engine [generated in 0.00014s] (50, 0)
2026-02-12 17:44:23,270 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49910 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:44:23,272 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49909 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:44:24,005 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:24,005 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:24,005 INFO sqlalchemy.engine.Engine [cached since 158.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:24,005 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:24,005 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:24,005 INFO sqlalchemy.engine.Engine [cached since 158.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:24,006 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:24,006 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:24,006 INFO sqlalchemy.engine.Engine [cached since 158.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:24,007 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:24,007 INFO sqlalchemy.engine.Engine [cached since 0.7485s ago] ('OPERATOR', 100, 0)
2026-02-12 17:44:24,007 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:44:24,007 INFO sqlalchemy.engine.Engine [cached since 158.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:24,007 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:44:24,008 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:44:24,008 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:24,008 INFO sqlalchemy.engine.Engine [cached since 1.776s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
INFO:     127.0.0.1:49915 - "GET /api/v1/users/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:49910 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:44:24,009 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49909 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:44:24,013 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:24,013 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:44:24,013 INFO sqlalchemy.engine.Engine [cached since 0.7531s ago] ('markup_percent',)
2026-02-12 17:44:24,014 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:24,015 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:24,015 INFO sqlalchemy.engine.Engine [cached since 158.3s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:24,015 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:24,015 INFO sqlalchemy.engine.Engine [cached since 0.7574s ago] ('MANAGER', 100, 0)
2026-02-12 17:44:24,017 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:44:24,017 INFO sqlalchemy.engine.Engine [cached since 0.7513s ago] ()
2026-02-12 17:44:24,017 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49909 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:44:24,020 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:44:24,020 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (50, 0)
2026-02-12 17:44:24,022 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49908 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:44:36,570 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,572 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,579 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:36,580 INFO sqlalchemy.engine.Engine [cached since 13.32s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,582 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:44:36,582 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,582 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49982 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:44:36,609 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,609 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:44:36,609 INFO sqlalchemy.engine.Engine [cached since 13.35s ago] ('markup_percent',)
2026-02-12 17:44:36,610 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:44:36,611 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:44:36,611 INFO sqlalchemy.engine.Engine [cached since 13.35s ago] ()
INFO:     127.0.0.1:49980 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine [cached since 14.39s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine [cached since 12.6s ago] (50, 0)
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,618 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:36,619 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:44:36,619 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49981 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,620 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:36,620 INFO sqlalchemy.engine.Engine [cached since 13.36s ago] ('MANAGER', 100, 0)
INFO:     127.0.0.1:49978 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:44:36,621 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49980 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:44:36,644 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,644 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,644 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:36,644 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,646 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,647 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:36,647 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:44:36,647 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:44:36,647 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,650 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 17:44:36,650 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,651 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49978 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:44:36,665 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 17:44:36,665 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 17:44:36,665 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 17:44:36,665 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] ()
2026-02-12 17:44:36,683 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 17:44:36,683 INFO sqlalchemy.engine.Engine [cached since 171s ago] ()
2026-02-12 17:44:36,695 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 17:44:36,695 INFO sqlalchemy.engine.Engine [cached since 171s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 17:44:36,700 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 17:44:36,700 INFO sqlalchemy.engine.Engine [cached since 171s ago] ('CANCELLED',)
2026-02-12 17:44:36,700 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 17:44:36,700 INFO sqlalchemy.engine.Engine [cached since 171s ago] (5,)
2026-02-12 17:44:36,709 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 17:44:36,709 INFO sqlalchemy.engine.Engine [cached since 171s ago] ()
2026-02-12 17:44:36,709 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 17:44:36,710 INFO sqlalchemy.engine.Engine [cached since 171s ago] ()
2026-02-12 17:44:36,711 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.operator_id = $1::UUID AND (applications.status NOT IN ($2::applicationstatus, $3::applicationstatus))
2026-02-12 17:44:36,711 INFO sqlalchemy.engine.Engine [cached since 171s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 'NEW', 'CANCELLED')
2026-02-12 17:44:36,712 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49980 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:44:36,725 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:44:36,725 INFO sqlalchemy.engine.Engine [cached since 171s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:44:36,728 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:44:36,728 INFO sqlalchemy.engine.Engine [cached since 14.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:44:36,734 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:49981 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 17:56:45,684 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:45,684 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:45,684 INFO sqlalchemy.engine.Engine [cached since 328.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:56:45,684 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:45,685 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:45,685 INFO sqlalchemy.engine.Engine [cached since 328.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:56:45,685 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:45,685 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:45,685 INFO sqlalchemy.engine.Engine [cached since 328.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:45,686 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:56:45,686 INFO sqlalchemy.engine.Engine [cached since 171s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:45,686 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:45,687 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:56:45,687 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:45,687 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:56:45,687 INFO sqlalchemy.engine.Engine [cached since 171s ago] ('markup_percent',)
2026-02-12 17:56:45,687 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:56:45,687 INFO sqlalchemy.engine.Engine [cached since 328.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:50169 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50171 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:56:45,688 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:56:45,688 INFO sqlalchemy.engine.Engine [cached since 171s ago] ()
2026-02-12 17:56:45,688 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:56:45,688 INFO sqlalchemy.engine.Engine [cached since 170.2s ago] (50, 0)
2026-02-12 17:56:45,689 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50170 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:56:45,690 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:56:45,690 INFO sqlalchemy.engine.Engine [cached since 172s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:56:45,693 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:45,693 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:45,693 INFO sqlalchemy.engine.Engine [cached since 328.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:45,694 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:56:45,694 INFO sqlalchemy.engine.Engine [cached since 171s ago] ('MANAGER', 100, 0)
2026-02-12 17:56:45,694 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50170 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:56:45,701 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50167 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:56:46,343 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:46,343 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:46,343 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:56:46,343 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:46,344 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:46,344 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:56:46,344 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:46,344 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:46,344 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine [cached since 171.6s ago] ('OPERATOR', 100, 0)
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine [cached since 171.6s ago] ('markup_percent',)
2026-02-12 17:56:46,345 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:56:46,346 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:50169 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 17:56:46,346 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:56:46,346 INFO sqlalchemy.engine.Engine [cached since 171.6s ago] ()
2026-02-12 17:56:46,346 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:56:46,347 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:56:46,347 INFO sqlalchemy.engine.Engine [cached since 172.7s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:56:46,347 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:56:46,347 INFO sqlalchemy.engine.Engine [cached since 170.9s ago] (50, 0)
INFO:     127.0.0.1:50170 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:56:46,348 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:56:46,348 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50171 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50167 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:56:46,353 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:56:46,354 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:56:46,354 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:56:46,354 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:56:46,354 INFO sqlalchemy.engine.Engine [cached since 171.6s ago] ('MANAGER', 100, 0)
2026-02-12 17:56:46,355 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50171 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50200 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:50201 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50203 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:57:19,329 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:57:19,329 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:57:19,329 INFO sqlalchemy.engine.Engine [cached since 362.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 17:57:19,329 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:57:19,329 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:57:19,329 INFO sqlalchemy.engine.Engine [cached since 362.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:57:19,331 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:57:19,331 INFO sqlalchemy.engine.Engine [cached since 204.6s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:57:19,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:57:19,332 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 17:57:19,332 INFO sqlalchemy.engine.Engine [cached since 204.6s ago] ('markup_percent',)
2026-02-12 17:57:19,333 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:57:19,333 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 17:57:19,334 INFO sqlalchemy.engine.Engine [cached since 362.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:50205 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 17:57:19,335 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:57:19,335 INFO sqlalchemy.engine.Engine [cached since 205.6s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 17:57:19,335 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 17:57:19,335 INFO sqlalchemy.engine.Engine [cached since 204.6s ago] ()
2026-02-12 17:57:19,337 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 17:57:19,338 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 17:57:19,338 INFO sqlalchemy.engine.Engine [cached since 203.9s ago] (50, 0)
INFO:     127.0.0.1:50205 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50200 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 17:57:19,340 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50201 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 17:57:19,341 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 17:57:19,341 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 17:57:19,341 INFO sqlalchemy.engine.Engine [cached since 362.2s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 17:57:19,342 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 17:57:19,342 INFO sqlalchemy.engine.Engine [cached since 204.6s ago] ('MANAGER', 100, 0)
2026-02-12 17:57:19,343 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50203 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50510 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:50514 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50515 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50516 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 18:04:14,174 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,174 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,174 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 18:04:14,175 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,175 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,175 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,176 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 18:04:14,176 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ('OPERATOR', 100, 0)
INFO:     127.0.0.1:50516 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 18:04:14,176 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,176 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:04:14,176 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ('markup_percent',)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,177 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 18:04:14,178 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 18:04:14,178 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,178 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,178 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:50518 - "GET /api/v1/users/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:50514 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,180 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 18:04:14,180 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
INFO:     127.0.0.1:50516 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 18:04:14,181 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,181 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,181 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 18:04:14,181 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,181 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,181 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 18:04:14,182 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 18:04:14,182 INFO sqlalchemy.engine.Engine [cached since 620.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,183 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,183 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 18:04:14,183 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ('OPERATOR', 100, 0)
2026-02-12 18:04:14,184 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 18:04:14,184 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:04:14,184 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ()
2026-02-12 18:04:14,184 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50518 - "GET /api/v1/users/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:50510 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:50514 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 18:04:14,185 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:04:14,185 INFO sqlalchemy.engine.Engine [cached since 618.7s ago] (50, 0)
2026-02-12 18:04:14,186 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,186 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,186 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 18:04:14,187 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998902222222 role=operator normalized=operator
INFO:     127.0.0.1:50515 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 18:04:14,188 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 18:04:14,188 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 18:04:14,189 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.operator_id = $1::UUID OR applications.operator_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 18:04:14,189 INFO sqlalchemy.engine.Engine [cached since 620.5s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 20, 0)
2026-02-12 18:04:14,190 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 18:04:14,190 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,190 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:04:14,190 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ('markup_percent',)
INFO:     127.0.0.1:50510 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 18:04:14,191 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:04:14,191 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ()
2026-02-12 18:04:14,192 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:04:14,192 INFO sqlalchemy.engine.Engine [cached since 618.7s ago] (50, 0)
2026-02-12 18:04:14,192 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50514 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 18:04:14,193 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,193 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,193 INFO sqlalchemy.engine.Engine [cached since 777s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,209 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 18:04:14,209 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ('MANAGER', 100, 0)
2026-02-12 18:04:14,210 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50520 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 18:04:14,212 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:04:14,212 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 18:04:14,212 INFO sqlalchemy.engine.Engine [cached since 777.1s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
AUTH DEBUG: User +998902222222 role=operator normalized=operator
2026-02-12 18:04:14,212 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 18:04:14,212 INFO sqlalchemy.engine.Engine [cached since 619.5s ago] ('MANAGER', 100, 0)
2026-02-12 18:04:14,213 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50520 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50615 - "GET /api/v1/applications HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50616 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50620 - "GET /api/v1/users/me HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50615 - "GET /api/v1/applications HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50616 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50622 - "GET /api/v1/users/me HTTP/1.1" 401 Unauthorized
2026-02-12 18:19:00,143 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:19:00,143 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:19:00,143 INFO sqlalchemy.engine.Engine [cached since 683.8s ago] ('markup_percent',)
2026-02-12 18:19:00,144 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:19:00,144 INFO sqlalchemy.engine.Engine [cached since 683.8s ago] ()
2026-02-12 18:19:00,144 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:19:00,144 INFO sqlalchemy.engine.Engine [cached since 683s ago] (50, 0)
2026-02-12 18:19:00,145 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50619 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 18:19:00,148 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:19:00,148 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:19:00,148 INFO sqlalchemy.engine.Engine [cached since 683.8s ago] ('markup_percent',)
2026-02-12 18:19:00,149 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:19:00,149 INFO sqlalchemy.engine.Engine [cached since 683.8s ago] ()
2026-02-12 18:19:00,149 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:19:00,149 INFO sqlalchemy.engine.Engine [cached since 683s ago] (50, 0)
2026-02-12 18:19:00,150 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50622 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50864 - "GET /api/v1/applications HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50865 - "GET /api/v1/auth/me HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:50864 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50865 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50865 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
2026-02-12 18:35:52,898 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:35:52,900 INFO sqlalchemy.engine.Engine SELECT stories.id, stories.title, stories.preview_image, stories."order", stories.is_active, stories.created_at, stories.updated_at 
FROM stories 
WHERE stories.is_active = true ORDER BY stories."order" ASC
2026-02-12 18:35:52,900 INFO sqlalchemy.engine.Engine [generated in 0.00021s] ()
2026-02-12 18:35:52,901 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:35:52,901 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:35:52,901 INFO sqlalchemy.engine.Engine [cached since 1696s ago] ('markup_percent',)
2026-02-12 18:35:52,905 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:35:52,905 INFO sqlalchemy.engine.Engine [cached since 1696s ago] ()
2026-02-12 18:35:52,907 INFO sqlalchemy.engine.Engine SELECT story_slides.story_id AS story_slides_story_id, story_slides.id AS story_slides_id, story_slides.title AS story_slides_title, story_slides.content AS story_slides_content, story_slides.button_text AS story_slides_button_text, story_slides.image_url AS story_slides_image_url, story_slides.button_link AS story_slides_button_link, story_slides."order" AS story_slides_order, story_slides.created_at AS story_slides_created_at, story_slides.updated_at AS story_slides_updated_at 
FROM story_slides 
WHERE story_slides.story_id IN ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::UUID) ORDER BY story_slides."order"
2026-02-12 18:35:52,907 INFO sqlalchemy.engine.Engine [generated in 0.00022s] (UUID('3803f068-cfa9-440e-814f-125be11d385a'), UUID('c2a30923-b7f9-44c3-8ffd-7812778860e0'), UUID('b1e41a9e-af0f-4ec6-bed3-6c5e6c6d0f55'), UUID('d5b94831-47cc-46c3-bc7e-643b84844601'), UUID('8e5e3fb5-99f0-43b2-a0b7-490b8120088a'), UUID('250e4d4d-7df5-4b65-808f-b37f0d9d5657'), UUID('bbeba7d8-4a97-441c-b969-b6e51081d782'))
2026-02-12 18:35:52,910 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 18:35:52,910 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:35:52,911 INFO sqlalchemy.engine.Engine [cached since 1695s ago] (20, 0)
INFO:     127.0.0.1:50866 - "GET /api/v1/stories HTTP/1.1" 200 OK
2026-02-12 18:35:52,912 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50864 - "GET /api/v1/cars?page=1&per_page=20 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50882 - "GET /uploads/stories/story_20260209175908_460e31c7.jpeg HTTP/1.1" 200 OK
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/story_20260209180837_65abc010.jpeg HTTP/1.1" 200 OK
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/story_20260209180107_ef2377b5.jpeg HTTP/1.1" 200 OK
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50867 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50868 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
2026-02-12 18:36:11,507 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:36:11,507 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:36:11,508 INFO sqlalchemy.engine.Engine [cached since 1715s ago] ('markup_percent',)
2026-02-12 18:36:11,510 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:36:11,510 INFO sqlalchemy.engine.Engine [cached since 1715s ago] ()
2026-02-12 18:36:11,510 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:36:11,511 INFO sqlalchemy.engine.Engine [cached since 1714s ago] (20, 0)
2026-02-12 18:36:11,512 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50887 - "GET /api/v1/cars?page=1&per_page=20 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50888 - "GET /uploads/cars/tahoe_1.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:50887 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50886 - "GET /api/v1/applications HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:50887 - "GET /api/v1/auth/me HTTP/1.1" 403 Forbidden
2026-02-12 18:36:19,081 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:36:19,081 INFO sqlalchemy.engine.Engine SELECT stories.id, stories.title, stories.preview_image, stories."order", stories.is_active, stories.created_at, stories.updated_at 
FROM stories 
WHERE stories.is_active = true ORDER BY stories."order" ASC
2026-02-12 18:36:19,081 INFO sqlalchemy.engine.Engine [cached since 26.18s ago] ()
2026-02-12 18:36:19,082 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 18:36:19,082 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 18:36:19,082 INFO sqlalchemy.engine.Engine [cached since 1722s ago] ('markup_percent',)
2026-02-12 18:36:19,084 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 18:36:19,084 INFO sqlalchemy.engine.Engine [cached since 1722s ago] ()
2026-02-12 18:36:19,085 INFO sqlalchemy.engine.Engine SELECT story_slides.story_id AS story_slides_story_id, story_slides.id AS story_slides_id, story_slides.title AS story_slides_title, story_slides.content AS story_slides_content, story_slides.button_text AS story_slides_button_text, story_slides.image_url AS story_slides_image_url, story_slides.button_link AS story_slides_button_link, story_slides."order" AS story_slides_order, story_slides.created_at AS story_slides_created_at, story_slides.updated_at AS story_slides_updated_at 
FROM story_slides 
WHERE story_slides.story_id IN ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::UUID) ORDER BY story_slides."order"
2026-02-12 18:36:19,085 INFO sqlalchemy.engine.Engine [cached since 26.18s ago] (UUID('3803f068-cfa9-440e-814f-125be11d385a'), UUID('c2a30923-b7f9-44c3-8ffd-7812778860e0'), UUID('b1e41a9e-af0f-4ec6-bed3-6c5e6c6d0f55'), UUID('d5b94831-47cc-46c3-bc7e-643b84844601'), UUID('8e5e3fb5-99f0-43b2-a0b7-490b8120088a'), UUID('250e4d4d-7df5-4b65-808f-b37f0d9d5657'), UUID('bbeba7d8-4a97-441c-b969-b6e51081d782'))
2026-02-12 18:36:19,086 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 18:36:19,086 INFO sqlalchemy.engine.Engine [cached since 1721s ago] (20, 0)
2026-02-12 18:36:19,087 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 18:36:19,088 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:50886 - "GET /api/v1/cars?page=1&per_page=20 HTTP/1.1" 200 OK
INFO:     127.0.0.1:50891 - "GET /api/v1/stories HTTP/1.1" 200 OK
INFO:     127.0.0.1:50892 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50893 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50892 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:50892 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:51750 - "OPTIONS /api/v1/auth/login HTTP/1.1" 200 OK
2026-02-12 19:52:47,953 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:47,955 INFO sqlalchemy.engine.Engine SELECT blacklist.id, blacklist.phone, blacklist.reason, blacklist.reason_note, blacklist.strike_count, blacklist.block_type, blacklist.blocked_until, blacklist.added_by, blacklist.created_at, blacklist.updated_at 
FROM blacklist 
WHERE blacklist.phone = $1::VARCHAR
2026-02-12 19:52:47,955 INFO sqlalchemy.engine.Engine [generated in 0.00025s] ('+998903333333',)
2026-02-12 19:52:47,965 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-12 19:52:47,965 INFO sqlalchemy.engine.Engine [generated in 0.00027s] ('+998903333333',)
2026-02-12 19:52:48,165 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:52:48,165 INFO sqlalchemy.engine.Engine [generated in 0.00019s] (UUID('b6a602e1-09b9-466b-ac06-6fa11e78109a'), None, None, 'user_login', 'user', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'null', 'null', None, 'null', datetime.datetime(2026, 2, 12, 14, 52, 48, 164983))
2026-02-12 19:52:48,168 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51750 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
INFO:     127.0.0.1:51750 - "OPTIONS /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 19:52:48,175 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:48,176 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:48,176 INFO sqlalchemy.engine.Engine [cached since 6469s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:48,176 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51752 - "GET /api/v1/users/me HTTP/1.1" 200 OK
INFO:     127.0.0.1:51752 - "OPTIONS /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:51750 - "OPTIONS /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:52:48,243 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:48,243 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:48,243 INFO sqlalchemy.engine.Engine [cached since 6469s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:48,244 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:48,244 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:48,244 INFO sqlalchemy.engine.Engine [cached since 6469s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:48,245 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:52:48,245 INFO sqlalchemy.engine.Engine [cached since 6469s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 19:52:48,246 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:52:48,246 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:48,247 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:52:48,247 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:52:48,247 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:52:48,247 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ()
2026-02-12 19:52:48,248 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:52:48,248 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ()
2026-02-12 19:52:48,250 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:52:48,250 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:52:48,251 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:52:48,251 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:52:48,252 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:52:48,252 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ('CANCELLED',)
2026-02-12 19:52:48,252 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:52:48,252 INFO sqlalchemy.engine.Engine [cached since 6469s ago] (5,)
2026-02-12 19:52:48,253 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:52:48,253 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ()
2026-02-12 19:52:48,254 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:52:48,255 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:52:48,255 INFO sqlalchemy.engine.Engine [cached since 6469s ago] ()
INFO:     127.0.0.1:51750 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:52:48,255 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:52:48,256 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 19:52:48,256 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51752 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:51752 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:51750 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51756 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51757 - "OPTIONS /api/v1/admin/stats?0=a&1=l&2=l HTTP/1.1" 200 OK
2026-02-12 19:52:50,903 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine [cached since 6471s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine [cached since 6471s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:50,904 INFO sqlalchemy.engine.Engine [cached since 6471s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:50,905 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:50,905 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 19:52:50,905 INFO sqlalchemy.engine.Engine [cached since 6314s ago] ('markup_percent',)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:50,906 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:52:50,907 INFO sqlalchemy.engine.Engine [cached since 6314s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:50,908 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:52:50,908 INFO sqlalchemy.engine.Engine [cached since 6471s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:50,909 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:52:50,909 INFO sqlalchemy.engine.Engine [cached since 2.663s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:50,910 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:52:50,910 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 19:52:50,910 INFO sqlalchemy.engine.Engine [cached since 6314s ago] ()
2026-02-12 19:52:50,911 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:52:50,911 INFO sqlalchemy.engine.Engine [cached since 6313s ago] (50, 0)
2026-02-12 19:52:50,911 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:52:50,911 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
INFO:     127.0.0.1:51750 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:52:50,912 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:52:50,916 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:52:50,916 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:52:50,917 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:52:50,917 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ()
INFO:     127.0.0.1:51756 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51750 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:52:50,918 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:52:50,918 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ()
2026-02-12 19:52:50,921 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51752 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:52:50,922 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:52:50,922 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:52:50,922 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:50,923 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:50,923 INFO sqlalchemy.engine.Engine [cached since 6471s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:50,924 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:52:50,924 INFO sqlalchemy.engine.Engine [cached since 6314s ago] ('MANAGER', 100, 0)
2026-02-12 19:52:50,924 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:52:50,924 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ('CANCELLED',)
2026-02-12 19:52:50,924 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:52:50,925 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:52:50,925 INFO sqlalchemy.engine.Engine [cached since 6471s ago] (5,)
INFO:     127.0.0.1:51759 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:52:50,927 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:52:50,927 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ()
2026-02-12 19:52:50,928 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:52:50,928 INFO sqlalchemy.engine.Engine [cached since 6471s ago] ()
2026-02-12 19:52:50,930 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:52:50,930 INFO sqlalchemy.engine.Engine [cached since 2.674s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 19:52:50,931 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51757 - "GET /api/v1/admin/stats?0=a&1=l&2=l HTTP/1.1" 200 OK
2026-02-12 19:52:52,887 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:52,887 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:52,888 INFO sqlalchemy.engine.Engine [cached since 6473s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:52,888 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:52:52,888 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:52:52,888 INFO sqlalchemy.engine.Engine [cached since 6473s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:52:52,891 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:52:52,892 INFO sqlalchemy.engine.Engine [cached since 6473s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 19:52:52,893 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:52:52,893 INFO sqlalchemy.engine.Engine [cached since 4.647s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:52:52,894 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:52:52,894 INFO sqlalchemy.engine.Engine [cached since 1.978s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:52:52,898 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51759 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:52:52,909 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:52:52,909 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:52:52,910 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:52:52,910 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ()
2026-02-12 19:52:52,911 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:52:52,911 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ()
2026-02-12 19:52:52,912 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:52:52,912 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:52:52,913 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:52:52,913 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ('CANCELLED',)
2026-02-12 19:52:52,914 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:52:52,914 INFO sqlalchemy.engine.Engine [cached since 6473s ago] (5,)
2026-02-12 19:52:52,916 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:52:52,916 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ()
2026-02-12 19:52:52,916 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:52:52,916 INFO sqlalchemy.engine.Engine [cached since 6473s ago] ()
2026-02-12 19:52:52,923 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:52:52,923 INFO sqlalchemy.engine.Engine [cached since 4.667s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 19:52:52,924 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51757 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:53:01,670 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:01,670 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:01,670 INFO sqlalchemy.engine.Engine [cached since 6482s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:01,675 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:01,675 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:01,675 INFO sqlalchemy.engine.Engine [cached since 6482s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:01,676 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:53:01,676 INFO sqlalchemy.engine.Engine [cached since 13.43s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:01,676 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:01,676 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 19:53:01,676 INFO sqlalchemy.engine.Engine [cached since 6325s ago] ('markup_percent',)
2026-02-12 19:53:01,676 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:01,677 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:01,677 INFO sqlalchemy.engine.Engine [cached since 6482s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:01,677 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:53:01,678 INFO sqlalchemy.engine.Engine [cached since 6325s ago] ('OPERATOR', 100, 0)
2026-02-12 19:53:01,678 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:53:01,678 INFO sqlalchemy.engine.Engine [cached since 10.76s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:53:01,679 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:01,680 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:53:01,680 INFO sqlalchemy.engine.Engine [cached since 6482s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 19:53:01,681 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 19:53:01,681 INFO sqlalchemy.engine.Engine [cached since 6325s ago] ()
2026-02-12 19:53:01,683 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:53:01,684 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:53:01,684 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
INFO:     127.0.0.1:51766 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:53:01,684 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:53:01,684 INFO sqlalchemy.engine.Engine [cached since 6324s ago] (50, 0)
2026-02-12 19:53:01,685 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:53:01,685 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ()
2026-02-12 19:53:01,686 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51761 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:53:01,686 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:53:01,686 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ()
2026-02-12 19:53:01,688 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:53:01,688 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:51767 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 19:53:01,688 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:53:01,688 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ('CANCELLED',)
2026-02-12 19:53:01,689 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:01,689 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:01,689 INFO sqlalchemy.engine.Engine [cached since 6482s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:01,689 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:53:01,689 INFO sqlalchemy.engine.Engine [cached since 6482s ago] (5,)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:01,690 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:53:01,690 INFO sqlalchemy.engine.Engine [cached since 6325s ago] ('MANAGER', 100, 0)
2026-02-12 19:53:01,690 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:53:01,690 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ()
2026-02-12 19:53:01,691 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:53:01,691 INFO sqlalchemy.engine.Engine [cached since 6482s ago] ()
2026-02-12 19:53:01,691 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:53:01,692 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:53:01,692 INFO sqlalchemy.engine.Engine [cached since 13.44s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 19:53:01,692 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51766 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51768 - "GET /api/v1/admin/stats?0=a&1=l&2=l HTTP/1.1" 200 OK
INFO:     127.0.0.1:51770 - "OPTIONS /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/comments HTTP/1.1" 200 OK
2026-02-12 19:53:07,987 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:07,987 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:07,987 INFO sqlalchemy.engine.Engine [cached since 6488s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:07,990 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:07,990 INFO sqlalchemy.engine.Engine [generated in 0.00024s] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:07,996 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 19:53:07,997 INFO sqlalchemy.engine.Engine [generated in 0.00114s] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:08,000 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51770 - "GET /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/comments HTTP/1.1" 200 OK
INFO:     127.0.0.1:51770 - "OPTIONS /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:51772 - "OPTIONS /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/videos HTTP/1.1" 200 OK
2026-02-12 19:53:08,011 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:08,011 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:08,011 INFO sqlalchemy.engine.Engine [cached since 6488s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:08,011 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:08,011 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:08,011 INFO sqlalchemy.engine.Engine [cached since 6488s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:08,012 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:08,012 INFO sqlalchemy.engine.Engine [cached since 0.02205s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:08,013 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:08,013 INFO sqlalchemy.engine.Engine [cached since 0.0225s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:08,014 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 19:53:08,014 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'VIDEO_SIGNATURE')
2026-02-12 19:53:08,016 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 19:53:08,016 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'VIDEO_SIGNATURE')
2026-02-12 19:53:08,027 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:53:08,027 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51772 - "GET /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:51770 - "GET /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/videos HTTP/1.1" 200 OK
INFO:     127.0.0.1:51770 - "OPTIONS /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/checklist HTTP/1.1" 200 OK
2026-02-12 19:53:10,674 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:10,675 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:10,675 INFO sqlalchemy.engine.Engine [cached since 6491s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:10,677 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:10,677 INFO sqlalchemy.engine.Engine [cached since 2.687s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:10,687 INFO sqlalchemy.engine.Engine UPDATE applications SET manager_id=$1::UUID, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:53:10,687 INFO sqlalchemy.engine.Engine [generated in 0.00033s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), datetime.datetime(2026, 2, 12, 14, 53, 10, 686983), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'))
2026-02-12 19:53:10,688 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:53:10,688 INFO sqlalchemy.engine.Engine [cached since 22.52s ago] (UUID('80ada4cc-4dae-4f62-9cd3-a689ea7ccc6f'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_auto_assigned', 'application', UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'null', '{"manager_id": "9b032fe3-25a4-4eb3-b110-f23655388cef"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 53, 10, 688623))
2026-02-12 19:53:10,691 INFO sqlalchemy.engine.Engine UPDATE applications SET checklist=$1::JSON, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:53:10,691 INFO sqlalchemy.engine.Engine [generated in 0.00020s] ('{"agreed_visit": true, "documents": false}', datetime.datetime(2026, 2, 12, 14, 53, 10, 691066), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'))
2026-02-12 19:53:10,692 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:53:10,695 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:10,696 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:10,696 INFO sqlalchemy.engine.Engine [generated in 0.00012s] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:10,698 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51772 - "PATCH /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/checklist HTTP/1.1" 200 OK
INFO:     127.0.0.1:51778 - "OPTIONS /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/status HTTP/1.1" 200 OK
2026-02-12 19:53:18,845 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:18,846 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:18,846 INFO sqlalchemy.engine.Engine [cached since 6499s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:18,848 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:18,848 INFO sqlalchemy.engine.Engine [cached since 10.86s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:18,850 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:53:18,850 INFO sqlalchemy.engine.Engine [generated in 0.00022s] ('DELIVERED', datetime.datetime(2026, 2, 12, 14, 53, 18, 850748), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'))
2026-02-12 19:53:18,852 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:53:18,852 INFO sqlalchemy.engine.Engine [cached since 30.69s ago] (UUID('941bef27-f047-40eb-8634-154df28128f2'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_status_changed', 'application', UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), '{"status": "paid"}', '{"status": "delivered", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 53, 18, 852191))
2026-02-12 19:53:18,855 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:53:18,855 INFO sqlalchemy.engine.Engine [generated in 0.00030s] (UUID('09f363d4-c940-477f-a6db-d9c7fff29bf3'), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'PAID', 'DELIVERED', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), '', datetime.datetime(2026, 2, 12, 14, 53, 18, 855185))
2026-02-12 19:53:18,857 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:53:18,859 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:18,859 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:53:18,860 INFO sqlalchemy.engine.Engine [cached since 8.163s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:53:18,861 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51778 - "PATCH /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/status HTTP/1.1" 200 OK
2026-02-12 19:53:18,866 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:18,866 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:18,866 INFO sqlalchemy.engine.Engine [cached since 6499s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:18,868 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:53:18,868 INFO sqlalchemy.engine.Engine [cached since 30.62s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:18,870 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:53:18,870 INFO sqlalchemy.engine.Engine [cached since 27.95s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:53:18,873 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51778 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:53:26,372 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:26,372 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:26,373 INFO sqlalchemy.engine.Engine [cached since 6507s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:26,373 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:53:26,373 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:53:26,373 INFO sqlalchemy.engine.Engine [cached since 6507s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:26,375 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:53:26,375 INFO sqlalchemy.engine.Engine [cached since 6507s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:53:26,376 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:53:26,377 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:53:26,377 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:53:26,378 INFO sqlalchemy.engine.Engine [cached since 38.13s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:53:26,378 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:53:26,378 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ()
2026-02-12 19:53:26,379 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:53:26,379 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ()
2026-02-12 19:53:26,379 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:53:26,380 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:53:26,380 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:53:26,380 INFO sqlalchemy.engine.Engine [cached since 35.46s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:53:26,381 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:53:26,381 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ('CANCELLED',)
2026-02-12 19:53:26,381 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:53:26,381 INFO sqlalchemy.engine.Engine [cached since 6507s ago] (5,)
2026-02-12 19:53:26,382 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:53:26,382 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ()
2026-02-12 19:53:26,384 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:53:26,384 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:53:26,384 INFO sqlalchemy.engine.Engine [cached since 6507s ago] ()
2026-02-12 19:53:26,385 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:53:26,385 INFO sqlalchemy.engine.Engine [cached since 38.13s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
INFO:     127.0.0.1:51784 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:53:26,386 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51780 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:54:15,075 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:15,076 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:15,076 INFO sqlalchemy.engine.Engine [cached since 6556s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:15,076 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:15,076 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:15,076 INFO sqlalchemy.engine.Engine [cached since 6556s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:15,077 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:15,077 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:15,077 INFO sqlalchemy.engine.Engine [cached since 6556s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:15,078 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:15,078 INFO sqlalchemy.engine.Engine [cached since 6398s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:15,079 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:54:15,079 INFO sqlalchemy.engine.Engine [cached since 6556s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 19:54:15,079 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:15,079 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 19:54:15,079 INFO sqlalchemy.engine.Engine [cached since 6398s ago] ('markup_percent',)
2026-02-12 19:54:15,080 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:15,081 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:15,081 INFO sqlalchemy.engine.Engine [cached since 86.83s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:15,081 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 19:54:15,081 INFO sqlalchemy.engine.Engine [cached since 6398s ago] ()
2026-02-12 19:54:15,082 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:54:15,082 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
INFO:     127.0.0.1:51794 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:54:15,083 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:54:15,083 INFO sqlalchemy.engine.Engine [cached since 6397s ago] (50, 0)
2026-02-12 19:54:15,084 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:15,084 INFO sqlalchemy.engine.Engine [cached since 84.17s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:54:15,084 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:54:15,084 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ()
2026-02-12 19:54:15,085 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51796 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 19:54:15,086 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:54:15,086 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ()
2026-02-12 19:54:15,088 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:15,089 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:54:15,089 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:51791 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:54:15,090 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:15,090 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:15,090 INFO sqlalchemy.engine.Engine [cached since 6556s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:15,091 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:54:15,091 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ('CANCELLED',)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:15,092 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:15,092 INFO sqlalchemy.engine.Engine [cached since 6398s ago] ('MANAGER', 100, 0)
2026-02-12 19:54:15,092 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:54:15,092 INFO sqlalchemy.engine.Engine [cached since 6556s ago] (5,)
2026-02-12 19:54:15,092 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51796 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:54:15,093 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:54:15,093 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ()
2026-02-12 19:54:15,094 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:54:15,094 INFO sqlalchemy.engine.Engine [cached since 6556s ago] ()
2026-02-12 19:54:15,095 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:54:15,095 INFO sqlalchemy.engine.Engine [cached since 86.84s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 19:54:15,096 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "GET /api/v1/admin/stats?0=a&1=l&2=l HTTP/1.1" 200 OK
INFO:     127.0.0.1:51797 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/assign HTTP/1.1" 200 OK
2026-02-12 19:54:19,537 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:19,538 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:19,538 INFO sqlalchemy.engine.Engine [cached since 6560s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:19,540 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:19,540 INFO sqlalchemy.engine.Engine [cached since 71.55s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:19,542 INFO sqlalchemy.engine.Engine UPDATE applications SET operator_id=$1::UUID, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:54:19,542 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), datetime.datetime(2026, 2, 12, 14, 54, 19, 542674), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 19:54:19,544 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:19,545 INFO sqlalchemy.engine.Engine [cached since 91.38s ago] (UUID('d23bdfe6-4e7e-4dce-b10b-2de64d92f416'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_assigned', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'null', '{"operator_id": "9b032fe3-25a4-4eb3-b110-f23655388cef"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 54, 19, 544821))
2026-02-12 19:54:19,547 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:19,549 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:19,549 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:19,550 INFO sqlalchemy.engine.Engine [cached since 68.85s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:19,551 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51796 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/assign HTTP/1.1" 200 OK
INFO:     127.0.0.1:51796 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
2026-02-12 19:54:19,560 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:19,560 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:19,560 INFO sqlalchemy.engine.Engine [cached since 6560s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:19,562 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:19,562 INFO sqlalchemy.engine.Engine [cached since 71.57s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:19,563 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 19:54:19,563 INFO sqlalchemy.engine.Engine [cached since 71.57s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:19,563 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
INFO:     127.0.0.1:51797 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:51796 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 19:54:19,576 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:19,576 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:19,576 INFO sqlalchemy.engine.Engine [cached since 6560s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:19,576 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:19,576 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:19,576 INFO sqlalchemy.engine.Engine [cached since 6560s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:19,577 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:19,577 INFO sqlalchemy.engine.Engine [cached since 71.59s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:19,577 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:19,578 INFO sqlalchemy.engine.Engine [cached since 71.59s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:19,578 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 19:54:19,578 INFO sqlalchemy.engine.Engine [cached since 71.56s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 19:54:19,578 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 19:54:19,578 INFO sqlalchemy.engine.Engine [cached since 71.56s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 19:54:19,579 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 19:54:19,586 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51791 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:51791 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 19:54:21,976 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:21,977 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:21,977 INFO sqlalchemy.engine.Engine [cached since 6562s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:21,979 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:21,979 INFO sqlalchemy.engine.Engine [cached since 73.99s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:21,980 INFO sqlalchemy.engine.Engine UPDATE applications SET manager_id=$1::UUID, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:54:21,981 INFO sqlalchemy.engine.Engine [cached since 71.29s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), datetime.datetime(2026, 2, 12, 14, 54, 21, 980961), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 19:54:21,982 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:21,982 INFO sqlalchemy.engine.Engine [cached since 93.82s ago] (UUID('b47795fb-be47-4640-939a-5f6fe1d91b2a'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_auto_assigned', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'null', '{"manager_id": "9b032fe3-25a4-4eb3-b110-f23655388cef"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 54, 21, 982472))
2026-02-12 19:54:21,983 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:54:21,983 INFO sqlalchemy.engine.Engine [cached since 63.13s ago] ('CONTRACT_SIGNED', datetime.datetime(2026, 2, 12, 14, 54, 21, 983881), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 19:54:21,985 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:21,985 INFO sqlalchemy.engine.Engine [cached since 93.82s ago] (UUID('051b5c8e-12a6-4451-b6f6-f7c443fb9a40'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_status_changed', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), '{"status": "confirmed"}', '{"status": "contract_signed", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 54, 21, 985517))
2026-02-12 19:54:21,986 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:21,986 INFO sqlalchemy.engine.Engine [cached since 63.13s ago] (UUID('e74d40c0-f0b1-46a9-98bb-08c34872b17b'), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'CONFIRMED', 'CONTRACT_SIGNED', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), '', datetime.datetime(2026, 2, 12, 14, 54, 21, 986354))
2026-02-12 19:54:21,988 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:21,990 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:21,990 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:21,990 INFO sqlalchemy.engine.Engine [cached since 71.29s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:21,992 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 19:54:21,998 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:21,998 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:21,998 INFO sqlalchemy.engine.Engine [cached since 6562s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:22,001 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:22,001 INFO sqlalchemy.engine.Engine [cached since 93.75s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:22,002 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:22,002 INFO sqlalchemy.engine.Engine [cached since 91.09s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:54:22,006 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:54:24,183 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:24,184 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:24,184 INFO sqlalchemy.engine.Engine [cached since 6565s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:24,186 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:24,186 INFO sqlalchemy.engine.Engine [cached since 76.19s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:24,188 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:54:24,188 INFO sqlalchemy.engine.Engine [cached since 65.34s ago] ('PAID', datetime.datetime(2026, 2, 12, 14, 54, 24, 188338), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 19:54:24,190 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:24,190 INFO sqlalchemy.engine.Engine [cached since 96.02s ago] (UUID('5d57eb0f-0311-47ec-89a3-cbf28a04c5c1'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_status_changed', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), '{"status": "contract_signed"}', '{"status": "paid", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 54, 24, 190243))
2026-02-12 19:54:24,192 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:24,192 INFO sqlalchemy.engine.Engine [cached since 65.34s ago] (UUID('e51b2a77-e48a-4900-9fcf-e764132f1e4b'), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'CONTRACT_SIGNED', 'PAID', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), '', datetime.datetime(2026, 2, 12, 14, 54, 24, 192374))
2026-02-12 19:54:24,193 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:24,195 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:24,196 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:24,196 INFO sqlalchemy.engine.Engine [cached since 73.5s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:24,197 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 19:54:24,202 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:24,203 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:24,203 INFO sqlalchemy.engine.Engine [cached since 6565s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:24,204 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:24,204 INFO sqlalchemy.engine.Engine [cached since 95.96s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:24,205 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:24,205 INFO sqlalchemy.engine.Engine [cached since 93.29s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:54:24,207 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:54:26,921 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:26,921 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:26,921 INFO sqlalchemy.engine.Engine [cached since 6567s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:26,922 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:26,922 INFO sqlalchemy.engine.Engine [cached since 78.93s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:26,924 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:54:26,924 INFO sqlalchemy.engine.Engine [cached since 68.07s ago] ('DELIVERED', datetime.datetime(2026, 2, 12, 14, 54, 26, 924007), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 19:54:26,924 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:26,925 INFO sqlalchemy.engine.Engine [cached since 98.76s ago] (UUID('bbd212e2-5f27-4a88-9222-5070caa93172'), UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), None, 'application_status_changed', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), '{"status": "paid"}', '{"status": "delivered", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 54, 26, 924930))
2026-02-12 19:54:26,925 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:26,925 INFO sqlalchemy.engine.Engine [cached since 68.07s ago] (UUID('3cfa510c-0d78-4b0f-988a-a717e52082a3'), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'PAID', 'DELIVERED', UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), '', datetime.datetime(2026, 2, 12, 14, 54, 26, 925747))
2026-02-12 19:54:26,926 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:26,928 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:26,928 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:54:26,928 INFO sqlalchemy.engine.Engine [cached since 76.23s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 19:54:26,929 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 19:54:26,932 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:26,932 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:26,932 INFO sqlalchemy.engine.Engine [cached since 6567s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:26,933 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:26,933 INFO sqlalchemy.engine.Engine [cached since 98.69s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:26,934 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:26,934 INFO sqlalchemy.engine.Engine [cached since 96.02s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:54:26,937 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51797 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:54:38,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:38,293 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:38,293 INFO sqlalchemy.engine.Engine [cached since 6579s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:38,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:38,294 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:38,294 INFO sqlalchemy.engine.Engine [cached since 6579s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:38,295 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:54:38,295 INFO sqlalchemy.engine.Engine [cached since 6579s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998903333333 role=manager normalized=manager
2026-02-12 19:54:38,298 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:54:38,299 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:54:38,300 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:38,300 INFO sqlalchemy.engine.Engine [cached since 110.1s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 19:54:38,300 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:54:38,300 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ()
2026-02-12 19:54:38,301 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:54:38,301 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ()
2026-02-12 19:54:38,302 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id 
WHERE applications.manager_id = $1::UUID OR applications.manager_id IS NULL ORDER BY applications.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:54:38,302 INFO sqlalchemy.engine.Engine [cached since 107.4s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 20, 0)
2026-02-12 19:54:38,302 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:54:38,302 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:54:38,303 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:54:38,303 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ('CANCELLED',)
2026-02-12 19:54:38,306 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:38,307 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:54:38,307 INFO sqlalchemy.engine.Engine [cached since 6579s ago] (5,)
INFO:     127.0.0.1:51803 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:54:38,308 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:54:38,308 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ()
2026-02-12 19:54:38,309 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:54:38,309 INFO sqlalchemy.engine.Engine [cached since 6579s ago] ()
2026-02-12 19:54:38,310 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:54:38,310 INFO sqlalchemy.engine.Engine [cached since 110.1s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 19:54:38,311 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51802 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:54:50,475 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:50,476 INFO sqlalchemy.engine.Engine SELECT blacklist.id, blacklist.phone, blacklist.reason, blacklist.reason_note, blacklist.strike_count, blacklist.block_type, blacklist.blocked_until, blacklist.added_by, blacklist.created_at, blacklist.updated_at 
FROM blacklist 
WHERE blacklist.phone = $1::VARCHAR
2026-02-12 19:54:50,476 INFO sqlalchemy.engine.Engine [cached since 122.5s ago] ('+998901111111',)
2026-02-12 19:54:50,478 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-12 19:54:50,478 INFO sqlalchemy.engine.Engine [cached since 122.5s ago] ('+998901111111',)
2026-02-12 19:54:50,678 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:54:50,678 INFO sqlalchemy.engine.Engine [cached since 122.5s ago] (UUID('7e2764e5-0031-4275-bcf6-5301887473d3'), None, None, 'user_login', 'user', UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), 'null', 'null', None, 'null', datetime.datetime(2026, 2, 12, 14, 54, 50, 678383))
2026-02-12 19:54:50,679 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51806 - "POST /api/v1/auth/login HTTP/1.1" 200 OK
2026-02-12 19:54:50,685 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:50,685 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:50,685 INFO sqlalchemy.engine.Engine [cached since 6591s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:54:50,685 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51806 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 19:54:50,698 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:50,698 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:50,698 INFO sqlalchemy.engine.Engine [cached since 6591s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:54:50,698 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:50,698 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:50,698 INFO sqlalchemy.engine.Engine [cached since 6591s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:54:50,699 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:54:50,699 INFO sqlalchemy.engine.Engine [cached since 6591s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:54:50,700 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:50,700 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ()
2026-02-12 19:54:50,701 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:54:50,701 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:54:50,703 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:54:50,703 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (20, 0)
2026-02-12 19:54:50,704 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:54:50,704 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ()
2026-02-12 19:54:50,704 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:54:50,704 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ()
2026-02-12 19:54:50,707 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:54:50,707 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:54:50,708 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:50,708 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:54:50,708 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ('CANCELLED',)
2026-02-12 19:54:50,709 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:54:50,709 INFO sqlalchemy.engine.Engine [cached since 6591s ago] (5,)
INFO:     127.0.0.1:51808 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:54:50,709 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:54:50,709 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ()
2026-02-12 19:54:50,710 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:54:50,710 INFO sqlalchemy.engine.Engine [cached since 6591s ago] ()
2026-02-12 19:54:50,710 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51806 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:54:57,209 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine [cached since 6598s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine [cached since 6598s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:54:57,210 INFO sqlalchemy.engine.Engine [cached since 6598s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:54:57,212 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:54:57,212 INFO sqlalchemy.engine.Engine [cached since 6598s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:54:57,213 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:57,214 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:54:57,214 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:54:57,214 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:54:57,214 INFO sqlalchemy.engine.Engine [cached since 6.514s ago] ()
INFO:     127.0.0.1:51828 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 19:54:57,215 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:54:57,215 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ()
2026-02-12 19:54:57,215 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:54:57,215 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ()
2026-02-12 19:54:57,215 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:54:57,215 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:54:57,217 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:54:57,218 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (20, 0)
2026-02-12 19:54:57,218 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:54:57,218 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ('CANCELLED',)
2026-02-12 19:54:57,218 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:54:57,218 INFO sqlalchemy.engine.Engine [cached since 6598s ago] (5,)
2026-02-12 19:54:57,219 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:54:57,219 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ()
2026-02-12 19:54:57,221 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:54:57,221 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:54:57,221 INFO sqlalchemy.engine.Engine [cached since 6598s ago] ()
INFO:     127.0.0.1:51827 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:54:57,222 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51826 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:55:09,722 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:09,723 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:09,724 INFO sqlalchemy.engine.Engine [cached since 6610s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:09,724 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:09,724 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:09,724 INFO sqlalchemy.engine.Engine [cached since 6610s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:09,725 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:09,726 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 19:55:09,726 INFO sqlalchemy.engine.Engine [cached since 6453s ago] ('markup_percent',)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:09,727 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:55:09,727 INFO sqlalchemy.engine.Engine [cached since 6453s ago] ('OPERATOR', 100, 0)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:09,729 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:55:09,729 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:55:09,729 INFO sqlalchemy.engine.Engine [cached since 19.03s ago] ()
2026-02-12 19:55:09,730 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 19:55:09,730 INFO sqlalchemy.engine.Engine [cached since 6453s ago] ()
2026-02-12 19:55:09,730 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:55:09,730 INFO sqlalchemy.engine.Engine [cached since 6452s ago] (50, 0)
2026-02-12 19:55:09,731 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:55:09,731 INFO sqlalchemy.engine.Engine [cached since 12.51s ago] (20, 0)
INFO:     127.0.0.1:51858 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:55:09,732 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:55:09,734 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51859 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51855 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:55:09,736 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:09,736 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:09,736 INFO sqlalchemy.engine.Engine [cached since 6610s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:09,737 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:55:09,737 INFO sqlalchemy.engine.Engine [cached since 6453s ago] ('MANAGER', 100, 0)
2026-02-12 19:55:09,738 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51858 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51864 - "OPTIONS /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/assign HTTP/1.1" 200 OK
2026-02-12 19:55:21,822 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:21,823 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:21,823 INFO sqlalchemy.engine.Engine [cached since 6622s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:21,824 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:55:21,825 INFO sqlalchemy.engine.Engine [cached since 133.8s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:55:21,826 INFO sqlalchemy.engine.Engine UPDATE applications SET operator_id=$1::UUID, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 19:55:21,827 INFO sqlalchemy.engine.Engine [cached since 62.28s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), datetime.datetime(2026, 2, 12, 14, 55, 21, 826963), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'))
2026-02-12 19:55:21,828 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 19:55:21,828 INFO sqlalchemy.engine.Engine [cached since 153.7s ago] (UUID('57e57e38-5cd2-45c5-98dd-031e7148f088'), UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), None, 'application_assigned', 'application', UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'null', '{"operator_id": "63048648-dacc-4d94-b87f-3e1068869cdd"}', None, 'null', datetime.datetime(2026, 2, 12, 14, 55, 21, 828643))
2026-02-12 19:55:21,829 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:55:21,831 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:21,831 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:55:21,831 INFO sqlalchemy.engine.Engine [cached since 131.1s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:55:21,833 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51864 - "PATCH /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/assign HTTP/1.1" 200 OK
2026-02-12 19:55:21,838 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:21,838 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:21,838 INFO sqlalchemy.engine.Engine [cached since 6622s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:21,839 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:55:21,839 INFO sqlalchemy.engine.Engine [cached since 133.8s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:55:21,842 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 19:55:21,842 INFO sqlalchemy.engine.Engine [cached since 133.8s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:55:21,842 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51864 - "GET /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/comments HTTP/1.1" 200 OK
2026-02-12 19:55:21,858 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:21,859 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:21,859 INFO sqlalchemy.engine.Engine [cached since 6622s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:21,859 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:21,859 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:21,859 INFO sqlalchemy.engine.Engine [cached since 6622s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:21,860 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:55:21,860 INFO sqlalchemy.engine.Engine [cached since 133.9s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:21,860 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 19:55:21,861 INFO sqlalchemy.engine.Engine [cached since 133.9s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 19:55:21,861 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 19:55:21,861 INFO sqlalchemy.engine.Engine [cached since 133.8s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'VIDEO_SIGNATURE')
2026-02-12 19:55:21,862 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 19:55:21,862 INFO sqlalchemy.engine.Engine [cached since 133.8s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'VIDEO_SIGNATURE')
2026-02-12 19:55:21,862 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51864 - "GET /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/documents HTTP/1.1" 200 OK
2026-02-12 19:55:21,867 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51866 - "GET /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/videos HTTP/1.1" 200 OK
2026-02-12 19:55:27,474 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:27,474 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:27,474 INFO sqlalchemy.engine.Engine [cached since 6628s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:27,474 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:27,475 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:27,475 INFO sqlalchemy.engine.Engine [cached since 6628s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:27,478 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:55:27,478 INFO sqlalchemy.engine.Engine [cached since 6628s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:27,480 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:55:27,480 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:55:27,481 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:55:27,481 INFO sqlalchemy.engine.Engine [cached since 36.78s ago] ()
2026-02-12 19:55:27,482 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:55:27,482 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ()
2026-02-12 19:55:27,483 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:55:27,483 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ()
2026-02-12 19:55:27,483 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:55:27,483 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:55:27,484 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:55:27,485 INFO sqlalchemy.engine.Engine [cached since 30.27s ago] (20, 0)
2026-02-12 19:55:27,485 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:55:27,485 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ('CANCELLED',)
2026-02-12 19:55:27,486 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:55:27,486 INFO sqlalchemy.engine.Engine [cached since 6628s ago] (5,)
2026-02-12 19:55:27,489 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:55:27,489 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:55:27,489 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ()
2026-02-12 19:55:27,490 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:55:27,490 INFO sqlalchemy.engine.Engine [cached since 6628s ago] ()
INFO:     127.0.0.1:51871 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:55:27,491 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51870 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:51870 - "OPTIONS /api/v1/admin/stats?period=week HTTP/1.1" 200 OK
2026-02-12 19:55:30,712 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:30,713 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:30,713 INFO sqlalchemy.engine.Engine [cached since 6631s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:30,713 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:30,713 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:30,713 INFO sqlalchemy.engine.Engine [cached since 6631s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:30,716 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($3::applicationstatus, $4::applicationstatus) AND applications.updated_at >= $2::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:30,716 INFO sqlalchemy.engine.Engine [generated in 0.00025s] (0, datetime.datetime(2026, 2, 5, 19, 55, 30, 714730), 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:30,717 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:55:30,717 INFO sqlalchemy.engine.Engine [cached since 40.02s ago] ()
2026-02-12 19:55:30,718 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus, $7::applicationstatus) AND applications.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:30,719 INFO sqlalchemy.engine.Engine [generated in 0.00021s] (datetime.datetime(2026, 2, 5, 19, 55, 30, 714730), 'NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:55:30,719 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:55:30,719 INFO sqlalchemy.engine.Engine [cached since 33.5s ago] (20, 0)
2026-02-12 19:55:30,721 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:55:30,721 INFO sqlalchemy.engine.Engine [cached since 6631s ago] ()
2026-02-12 19:55:30,722 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:30,722 INFO sqlalchemy.engine.Engine [generated in 0.00010s] (datetime.datetime(2026, 2, 5, 19, 55, 30, 714730),)
2026-02-12 19:55:30,723 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus) AND applications.updated_at >= $1::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:30,723 INFO sqlalchemy.engine.Engine [generated in 0.00015s] (datetime.datetime(2026, 2, 5, 19, 55, 30, 714730), 'COMPLETED', 'DELIVERED')
2026-02-12 19:55:30,758 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51871 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:55:30,760 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus AND applications.updated_at >= $2::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:30,760 INFO sqlalchemy.engine.Engine [generated in 0.00008s] ('CANCELLED', datetime.datetime(2026, 2, 5, 19, 55, 30, 714730))
2026-02-12 19:55:30,761 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs 
WHERE audit_logs.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE ORDER BY audit_logs.created_at DESC 
 LIMIT $2::INTEGER
2026-02-12 19:55:30,761 INFO sqlalchemy.engine.Engine [generated in 0.00007s] (datetime.datetime(2026, 2, 5, 19, 55, 30, 714730), 5)
2026-02-12 19:55:30,762 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:55:30,762 INFO sqlalchemy.engine.Engine [cached since 6631s ago] ()
2026-02-12 19:55:30,762 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:55:30,762 INFO sqlalchemy.engine.Engine [cached since 6631s ago] ()
2026-02-12 19:55:30,763 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51870 - "GET /api/v1/admin/stats?period=week HTTP/1.1" 200 OK
INFO:     127.0.0.1:51870 - "OPTIONS /api/v1/admin/stats?period=month HTTP/1.1" 200 OK
2026-02-12 19:55:33,395 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:33,396 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:33,396 INFO sqlalchemy.engine.Engine [cached since 6634s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:33,396 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:33,396 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:33,396 INFO sqlalchemy.engine.Engine [cached since 6634s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:33,397 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($3::applicationstatus, $4::applicationstatus) AND applications.updated_at >= $2::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:33,397 INFO sqlalchemy.engine.Engine [cached since 2.682s ago] (0, datetime.datetime(2026, 1, 13, 19, 55, 33, 396879), 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:33,399 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:55:33,399 INFO sqlalchemy.engine.Engine [cached since 42.7s ago] ()
2026-02-12 19:55:33,400 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus, $7::applicationstatus) AND applications.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:33,400 INFO sqlalchemy.engine.Engine [cached since 2.681s ago] (datetime.datetime(2026, 1, 13, 19, 55, 33, 396879), 'NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:55:33,400 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:55:33,400 INFO sqlalchemy.engine.Engine [cached since 36.18s ago] (20, 0)
2026-02-12 19:55:33,401 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:55:33,401 INFO sqlalchemy.engine.Engine [cached since 6634s ago] ()
2026-02-12 19:55:33,403 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:55:33,403 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:33,403 INFO sqlalchemy.engine.Engine [cached since 2.682s ago] (datetime.datetime(2026, 1, 13, 19, 55, 33, 396879),)
INFO:     127.0.0.1:51871 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:55:33,405 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus) AND applications.updated_at >= $1::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:33,405 INFO sqlalchemy.engine.Engine [cached since 2.682s ago] (datetime.datetime(2026, 1, 13, 19, 55, 33, 396879), 'COMPLETED', 'DELIVERED')
2026-02-12 19:55:33,406 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus AND applications.updated_at >= $2::TIMESTAMP WITHOUT TIME ZONE
2026-02-12 19:55:33,406 INFO sqlalchemy.engine.Engine [cached since 2.646s ago] ('CANCELLED', datetime.datetime(2026, 1, 13, 19, 55, 33, 396879))
2026-02-12 19:55:33,406 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs 
WHERE audit_logs.created_at >= $1::TIMESTAMP WITHOUT TIME ZONE ORDER BY audit_logs.created_at DESC 
 LIMIT $2::INTEGER
2026-02-12 19:55:33,406 INFO sqlalchemy.engine.Engine [cached since 2.646s ago] (datetime.datetime(2026, 1, 13, 19, 55, 33, 396879), 5)
2026-02-12 19:55:33,407 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:55:33,407 INFO sqlalchemy.engine.Engine [cached since 6634s ago] ()
2026-02-12 19:55:33,408 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:55:33,408 INFO sqlalchemy.engine.Engine [cached since 6634s ago] ()
2026-02-12 19:55:33,408 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51873 - "GET /api/v1/admin/stats?period=month HTTP/1.1" 200 OK
2026-02-12 19:55:35,063 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:35,063 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:35,063 INFO sqlalchemy.engine.Engine [cached since 6636s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:55:35,063 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:55:35,063 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:55:35,063 INFO sqlalchemy.engine.Engine [cached since 6636s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:55:35,065 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:55:35,065 INFO sqlalchemy.engine.Engine [cached since 6636s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 19:55:35,065 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:55:35,066 INFO sqlalchemy.engine.Engine [cached since 44.36s ago] ()
2026-02-12 19:55:35,066 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:55:35,066 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:55:35,067 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:55:35,067 INFO sqlalchemy.engine.Engine [cached since 37.85s ago] (20, 0)
2026-02-12 19:55:35,067 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:55:35,067 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ()
2026-02-12 19:55:35,067 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:55:35,067 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ()
2026-02-12 19:55:35,070 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:55:35,070 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:55:35,070 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ('COMPLETED', 'DELIVERED')
INFO:     127.0.0.1:51871 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:55:35,071 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:55:35,071 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ('CANCELLED',)
2026-02-12 19:55:35,072 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:55:35,072 INFO sqlalchemy.engine.Engine [cached since 6636s ago] (5,)
2026-02-12 19:55:35,073 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:55:35,073 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ()
2026-02-12 19:55:35,073 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:55:35,073 INFO sqlalchemy.engine.Engine [cached since 6636s ago] ()
2026-02-12 19:55:35,074 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51873 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:56:00,821 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:00,821 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:00,821 INFO sqlalchemy.engine.Engine [cached since 6661s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:56:00,822 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:00,822 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:00,822 INFO sqlalchemy.engine.Engine [cached since 6661s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:00,823 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:00,824 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 19:56:00,824 INFO sqlalchemy.engine.Engine [cached since 6504s ago] ('markup_percent',)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:00,825 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:56:00,825 INFO sqlalchemy.engine.Engine [cached since 6504s ago] ('OPERATOR', 100, 0)
2026-02-12 19:56:00,826 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:56:00,826 INFO sqlalchemy.engine.Engine [cached since 70.2s ago] ()
2026-02-12 19:56:00,826 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:56:00,827 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 19:56:00,827 INFO sqlalchemy.engine.Engine [cached since 6504s ago] ()
2026-02-12 19:56:00,827 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:56:00,827 INFO sqlalchemy.engine.Engine [cached since 63.69s ago] (20, 0)
2026-02-12 19:56:00,828 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:56:00,828 INFO sqlalchemy.engine.Engine [cached since 6503s ago] (50, 0)
INFO:     127.0.0.1:51885 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 19:56:00,830 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:56:00,831 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51886 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51882 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 19:56:00,833 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:00,833 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:00,833 INFO sqlalchemy.engine.Engine [cached since 6661s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:00,834 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 19:56:00,834 INFO sqlalchemy.engine.Engine [cached since 6504s ago] ('MANAGER', 100, 0)
2026-02-12 19:56:00,834 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51885 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51885 - "OPTIONS /api/v1/stories HTTP/1.1" 200 OK
2026-02-12 19:56:04,140 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:04,141 INFO sqlalchemy.engine.Engine SELECT stories.id, stories.title, stories.preview_image, stories."order", stories.is_active, stories.created_at, stories.updated_at 
FROM stories 
WHERE stories.is_active = true ORDER BY stories."order" ASC
2026-02-12 19:56:04,141 INFO sqlalchemy.engine.Engine [cached since 4811s ago] ()
2026-02-12 19:56:04,143 INFO sqlalchemy.engine.Engine SELECT story_slides.story_id AS story_slides_story_id, story_slides.id AS story_slides_id, story_slides.title AS story_slides_title, story_slides.content AS story_slides_content, story_slides.button_text AS story_slides_button_text, story_slides.image_url AS story_slides_image_url, story_slides.button_link AS story_slides_button_link, story_slides."order" AS story_slides_order, story_slides.created_at AS story_slides_created_at, story_slides.updated_at AS story_slides_updated_at 
FROM story_slides 
WHERE story_slides.story_id IN ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::UUID) ORDER BY story_slides."order"
2026-02-12 19:56:04,143 INFO sqlalchemy.engine.Engine [cached since 4811s ago] (UUID('3803f068-cfa9-440e-814f-125be11d385a'), UUID('c2a30923-b7f9-44c3-8ffd-7812778860e0'), UUID('b1e41a9e-af0f-4ec6-bed3-6c5e6c6d0f55'), UUID('d5b94831-47cc-46c3-bc7e-643b84844601'), UUID('8e5e3fb5-99f0-43b2-a0b7-490b8120088a'), UUID('250e4d4d-7df5-4b65-808f-b37f0d9d5657'), UUID('bbeba7d8-4a97-441c-b969-b6e51081d782'))
2026-02-12 19:56:04,146 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51885 - "GET /api/v1/stories HTTP/1.1" 200 OK
INFO:     127.0.0.1:51889 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:51890 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:51885 - "OPTIONS /api/v1/users HTTP/1.1" 200 OK
2026-02-12 19:56:05,182 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:05,182 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:05,182 INFO sqlalchemy.engine.Engine [cached since 6666s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:05,184 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:56:05,185 INFO sqlalchemy.engine.Engine [generated in 0.00022s] (20, 0)
2026-02-12 19:56:05,186 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51885 - "GET /api/v1/users HTTP/1.1" 200 OK
2026-02-12 19:56:05,963 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:05,964 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:05,964 INFO sqlalchemy.engine.Engine [cached since 6667s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:05,965 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:56:05,965 INFO sqlalchemy.engine.Engine [cached since 0.7809s ago] (20, 0)
2026-02-12 19:56:05,967 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51885 - "GET /api/v1/users HTTP/1.1" 200 OK
2026-02-12 19:56:09,055 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:09,055 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:09,055 INFO sqlalchemy.engine.Engine [cached since 6670s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:56:09,056 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:09,056 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:09,056 INFO sqlalchemy.engine.Engine [cached since 6670s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:09,057 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 19:56:09,057 INFO sqlalchemy.engine.Engine [cached since 6670s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:09,059 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:56:09,059 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:56:09,060 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:56:09,060 INFO sqlalchemy.engine.Engine [cached since 78.43s ago] ()
2026-02-12 19:56:09,060 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:56:09,060 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ()
2026-02-12 19:56:09,061 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:56:09,061 INFO sqlalchemy.engine.Engine [cached since 71.92s ago] (20, 0)
2026-02-12 19:56:09,062 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:56:09,062 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ()
2026-02-12 19:56:09,064 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:56:09,064 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:56:09,066 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:56:09,066 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:56:09,066 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ('CANCELLED',)
INFO:     127.0.0.1:51892 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:56:09,067 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:56:09,067 INFO sqlalchemy.engine.Engine [cached since 6670s ago] (5,)
2026-02-12 19:56:09,068 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:56:09,068 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ()
2026-02-12 19:56:09,068 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:56:09,068 INFO sqlalchemy.engine.Engine [cached since 6670s ago] ()
2026-02-12 19:56:09,069 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51885 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 19:56:11,210 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:56:11,211 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:56:11,211 INFO sqlalchemy.engine.Engine [cached since 6672s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:56:11,212 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:56:11,212 INFO sqlalchemy.engine.Engine [cached since 6.028s ago] (20, 0)
2026-02-12 19:56:11,214 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51885 - "GET /api/v1/users HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/api/admin.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [34493]
INFO:     Started server process [38312]
INFO:     Waiting for application startup.
2026-02-12 19:57:51,673 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-12 19:57:51,673 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 19:57:51,674 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-12 19:57:51,674 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 19:57:51,674 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-12 19:57:51,674 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 19:57:51,675 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:57:51,676 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,676 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,680 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,680 INFO sqlalchemy.engine.Engine [cached since 0.003832s ago] ('cars_catalog', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,681 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,681 INFO sqlalchemy.engine.Engine [cached since 0.004379s ago] ('cars_price_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,681 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,681 INFO sqlalchemy.engine.Engine [cached since 0.004811s ago] ('applications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,682 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,682 INFO sqlalchemy.engine.Engine [cached since 0.005201s ago] ('application_status_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,682 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,682 INFO sqlalchemy.engine.Engine [cached since 0.005579s ago] ('application_comments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,682 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,682 INFO sqlalchemy.engine.Engine [cached since 0.005951s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine [cached since 0.006167s ago] ('settings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine [cached since 0.006381s ago] ('blacklist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine [cached since 0.0066s ago] ('documents', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine [cached since 0.006814s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,683 INFO sqlalchemy.engine.Engine [cached since 0.007029s ago] ('stories', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,684 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 19:57:51,684 INFO sqlalchemy.engine.Engine [cached since 0.00723s ago] ('story_slides', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 19:57:51,684 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,684 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ('role', 'pg_catalog')
2026-02-12 19:57:51,685 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,685 INFO sqlalchemy.engine.Engine [cached since 0.0007696s ago] ('applicationstatus', 'pg_catalog')
2026-02-12 19:57:51,685 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,685 INFO sqlalchemy.engine.Engine [cached since 0.001186s ago] ('contactstatus', 'pg_catalog')
2026-02-12 19:57:51,686 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,686 INFO sqlalchemy.engine.Engine [cached since 0.001578s ago] ('rejectionreason', 'pg_catalog')
2026-02-12 19:57:51,686 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,686 INFO sqlalchemy.engine.Engine [cached since 0.002015s ago] ('blacklistreason', 'pg_catalog')
2026-02-12 19:57:51,687 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,687 INFO sqlalchemy.engine.Engine [cached since 0.002404s ago] ('blocktype', 'pg_catalog')
2026-02-12 19:57:51,687 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,687 INFO sqlalchemy.engine.Engine [cached since 0.002775s ago] ('documenttype', 'pg_catalog')
2026-02-12 19:57:51,687 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,687 INFO sqlalchemy.engine.Engine [cached since 0.003059s ago] ('paymentmethod', 'pg_catalog')
2026-02-12 19:57:51,688 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 19:57:51,688 INFO sqlalchemy.engine.Engine [cached since 0.003314s ago] ('paymentstatus', 'pg_catalog')
2026-02-12 19:57:51,688 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
2026-02-12 19:59:42,956 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:59:42,982 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:59:42,983 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 19:59:42,989 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 19:59:42,989 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 19:59:42,989 INFO sqlalchemy.engine.Engine [cached since 0.006456s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:59:42,997 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER) * $2::INTEGER) AS profit 
FROM applications 
WHERE applications.status IN ($3::applicationstatus, $4::applicationstatus)
2026-02-12 19:59:42,997 INFO sqlalchemy.engine.Engine [generated in 0.00021s] (0, 12500, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 19:59:43,004 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 19:59:43,005 INFO sqlalchemy.engine.Engine [generated in 0.00077s] ()
2026-02-12 19:59:43,006 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 19:59:43,006 INFO sqlalchemy.engine.Engine [generated in 0.00017s] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 19:59:43,007 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 19:59:43,007 INFO sqlalchemy.engine.Engine [generated in 0.00010s] ()
2026-02-12 19:59:43,012 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 19:59:43,012 INFO sqlalchemy.engine.Engine [generated in 0.00015s] (20, 0)
2026-02-12 19:59:43,014 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 19:59:43,014 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ()
2026-02-12 19:59:43,015 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 19:59:43,015 INFO sqlalchemy.engine.Engine [cached since 0.008951s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 19:59:43,016 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 19:59:43,016 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ('CANCELLED',)
2026-02-12 19:59:43,017 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 19:59:43,017 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (5,)
2026-02-12 19:59:43,020 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 19:59:43,021 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 19:59:43,021 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
INFO:     127.0.0.1:51925 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 19:59:43,022 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 19:59:43,022 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ()
2026-02-12 19:59:43,026 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51923 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/api/admin.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [38312]
INFO:     Started server process [38364]
INFO:     Waiting for application startup.
2026-02-12 20:00:44,454 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-12 20:00:44,455 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 20:00:44,455 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-12 20:00:44,455 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 20:00:44,456 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-12 20:00:44,456 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 20:00:44,457 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:00:44,458 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,458 INFO sqlalchemy.engine.Engine [generated in 0.00008s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,462 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,462 INFO sqlalchemy.engine.Engine [cached since 0.003524s ago] ('cars_catalog', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,462 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,462 INFO sqlalchemy.engine.Engine [cached since 0.003907s ago] ('cars_price_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,462 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,462 INFO sqlalchemy.engine.Engine [cached since 0.004235s ago] ('applications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine [cached since 0.004543s ago] ('application_status_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine [cached since 0.004841s ago] ('application_comments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine [cached since 0.005147s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,463 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine [cached since 0.005343s ago] ('settings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine [cached since 0.005542s ago] ('blacklist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine [cached since 0.005741s ago] ('documents', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine [cached since 0.00593s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine [cached since 0.006121s ago] ('stories', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:00:44,464 INFO sqlalchemy.engine.Engine [cached since 0.006313s ago] ('story_slides', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:00:44,465 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,465 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ('role', 'pg_catalog')
2026-02-12 20:00:44,466 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,466 INFO sqlalchemy.engine.Engine [cached since 0.0008402s ago] ('applicationstatus', 'pg_catalog')
2026-02-12 20:00:44,466 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,466 INFO sqlalchemy.engine.Engine [cached since 0.001262s ago] ('contactstatus', 'pg_catalog')
2026-02-12 20:00:44,467 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,467 INFO sqlalchemy.engine.Engine [cached since 0.001646s ago] ('rejectionreason', 'pg_catalog')
2026-02-12 20:00:44,467 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,467 INFO sqlalchemy.engine.Engine [cached since 0.002044s ago] ('blacklistreason', 'pg_catalog')
2026-02-12 20:00:44,468 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,468 INFO sqlalchemy.engine.Engine [cached since 0.002403s ago] ('blocktype', 'pg_catalog')
2026-02-12 20:00:44,468 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,468 INFO sqlalchemy.engine.Engine [cached since 0.002783s ago] ('documenttype', 'pg_catalog')
2026-02-12 20:00:44,468 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,468 INFO sqlalchemy.engine.Engine [cached since 0.003071s ago] ('paymentmethod', 'pg_catalog')
2026-02-12 20:00:44,469 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:00:44,469 INFO sqlalchemy.engine.Engine [cached since 0.003356s ago] ('paymentstatus', 'pg_catalog')
2026-02-12 20:00:44,469 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
2026-02-12 20:01:25,642 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:25,661 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:25,662 INFO sqlalchemy.engine.Engine [generated in 0.00016s] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:01:25,667 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:25,667 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:25,667 INFO sqlalchemy.engine.Engine [cached since 0.005499s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:01:25,667 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:25,667 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:25,667 INFO sqlalchemy.engine.Engine [cached since 0.005764s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:01:25,673 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:01:25,674 INFO sqlalchemy.engine.Engine [generated in 0.00014s] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:01:25,677 INFO sqlalchemy.engine.Engine COMMIT
AUTH DEBUG: User +998901111111 role=admin normalized=admin
INFO:     127.0.0.1:51955 - "GET /api/v1/users/me HTTP/1.1" 200 OK
2026-02-12 20:01:25,682 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:01:25,682 INFO sqlalchemy.engine.Engine [generated in 0.00012s] ()
2026-02-12 20:01:25,683 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:01:25,683 INFO sqlalchemy.engine.Engine [generated in 0.00012s] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:01:25,684 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:01:25,684 INFO sqlalchemy.engine.Engine [generated in 0.00008s] ()
2026-02-12 20:01:25,689 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:01:25,689 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (20, 0)
2026-02-12 20:01:25,690 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:01:25,690 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ()
2026-02-12 20:01:25,691 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:01:25,691 INFO sqlalchemy.engine.Engine [cached since 0.008168s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:01:25,692 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:01:25,692 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('CANCELLED',)
2026-02-12 20:01:25,693 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:01:25,693 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (5,)
2026-02-12 20:01:25,696 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:01:25,697 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:01:25,697 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
INFO:     127.0.0.1:51954 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:01:25,698 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:01:25,698 INFO sqlalchemy.engine.Engine [generated in 0.00007s] ()
2026-02-12 20:01:25,702 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51953 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:51959 - "OPTIONS /api/v1/cars HTTP/1.1" 200 OK
2026-02-12 20:01:30,973 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:30,974 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:01:30,975 INFO sqlalchemy.engine.Engine [generated in 0.00015s] ('markup_percent',)
2026-02-12 20:01:30,978 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:01:30,979 INFO sqlalchemy.engine.Engine [generated in 0.00026s] ()
2026-02-12 20:01:30,983 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:01:30,983 INFO sqlalchemy.engine.Engine [generated in 0.00018s] (20, 0)
2026-02-12 20:01:30,985 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51959 - "GET /api/v1/cars HTTP/1.1" 200 OK
2026-02-12 20:01:33,391 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:33,391 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:33,391 INFO sqlalchemy.engine.Engine [cached since 7.73s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:01:33,391 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:33,392 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:33,392 INFO sqlalchemy.engine.Engine [cached since 7.73s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:01:33,392 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:33,392 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:01:33,392 INFO sqlalchemy.engine.Engine [cached since 2.418s ago] ('markup_percent',)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:01:33,395 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:01:33,395 INFO sqlalchemy.engine.Engine [generated in 0.00026s] ('OPERATOR', 100, 0)
2026-02-12 20:01:33,396 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:01:33,396 INFO sqlalchemy.engine.Engine [cached since 7.714s ago] ()
2026-02-12 20:01:33,397 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:01:33,397 INFO sqlalchemy.engine.Engine [cached since 2.418s ago] ()
2026-02-12 20:01:33,401 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:01:33,401 INFO sqlalchemy.engine.Engine [generated in 0.00014s] (20, 0)
2026-02-12 20:01:33,402 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:01:33,402 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (50, 0)
2026-02-12 20:01:33,403 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:01:33,405 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:01:33,406 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51962 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51959 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:51963 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 20:01:33,409 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:33,409 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:33,409 INFO sqlalchemy.engine.Engine [cached since 7.748s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:01:33,410 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:01:33,410 INFO sqlalchemy.engine.Engine [cached since 0.01547s ago] ('MANAGER', 100, 0)
2026-02-12 20:01:33,411 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51963 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:01:48,944 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:48,944 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:48,944 INFO sqlalchemy.engine.Engine [cached since 23.28s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:01:48,944 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:01:48,945 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:01:48,945 INFO sqlalchemy.engine.Engine [cached since 23.28s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:01:48,947 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:01:48,947 INFO sqlalchemy.engine.Engine [cached since 23.27s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 20:01:48,948 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:01:48,948 INFO sqlalchemy.engine.Engine [cached since 23.27s ago] ()
2026-02-12 20:01:48,949 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:01:48,949 INFO sqlalchemy.engine.Engine [cached since 23.27s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:01:48,950 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:01:48,950 INFO sqlalchemy.engine.Engine [cached since 15.55s ago] (20, 0)
2026-02-12 20:01:48,951 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:01:48,951 INFO sqlalchemy.engine.Engine [cached since 23.27s ago] ()
2026-02-12 20:01:48,951 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:01:48,952 INFO sqlalchemy.engine.Engine [cached since 23.26s ago] ()
2026-02-12 20:01:48,953 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:01:48,953 INFO sqlalchemy.engine.Engine [cached since 23.27s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:01:48,954 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:01:48,954 INFO sqlalchemy.engine.Engine [cached since 23.26s ago] ('CANCELLED',)
2026-02-12 20:01:48,954 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:01:48,954 INFO sqlalchemy.engine.Engine [cached since 23.26s ago] (5,)
2026-02-12 20:01:48,957 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:01:48,957 INFO sqlalchemy.engine.Engine [cached since 23.26s ago] ()
2026-02-12 20:01:48,959 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:01:48,960 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:01:48,960 INFO sqlalchemy.engine.Engine [cached since 23.26s ago] ()
INFO:     127.0.0.1:51968 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:01:48,961 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51967 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:51972 - "OPTIONS /api/v1/admin/settings HTTP/1.1" 200 OK
2026-02-12 20:02:10,580 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:10,581 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:10,581 INFO sqlalchemy.engine.Engine [cached since 44.92s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:10,583 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings
2026-02-12 20:02:10,583 INFO sqlalchemy.engine.Engine [generated in 0.00025s] ()
2026-02-12 20:02:10,586 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51972 - "GET /api/v1/admin/settings HTTP/1.1" 200 OK
2026-02-12 20:02:15,738 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:15,738 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:15,738 INFO sqlalchemy.engine.Engine [cached since 50.08s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:15,739 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:15,739 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:15,739 INFO sqlalchemy.engine.Engine [cached since 50.08s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:15,741 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:02:15,741 INFO sqlalchemy.engine.Engine [cached since 50.07s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 20:02:15,742 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:15,742 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ()
2026-02-12 20:02:15,743 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:15,743 INFO sqlalchemy.engine.Engine [cached since 42.34s ago] (20, 0)
2026-02-12 20:02:15,744 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:02:15,744 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:02:15,746 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:15,747 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:02:15,747 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ()
INFO:     127.0.0.1:51976 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:02:15,748 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:02:15,748 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ()
2026-02-12 20:02:15,749 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:02:15,749 INFO sqlalchemy.engine.Engine [cached since 50.07s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:02:15,750 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:02:15,750 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ('CANCELLED',)
2026-02-12 20:02:15,751 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:02:15,751 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] (5,)
2026-02-12 20:02:15,753 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:02:15,753 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ()
2026-02-12 20:02:15,754 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:02:15,754 INFO sqlalchemy.engine.Engine [cached since 50.06s ago] ()
2026-02-12 20:02:15,755 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51974 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 20:02:16,757 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:16,758 INFO sqlalchemy.engine.Engine SELECT stories.id, stories.title, stories.preview_image, stories."order", stories.is_active, stories.created_at, stories.updated_at 
FROM stories 
WHERE stories.is_active = true ORDER BY stories."order" ASC
2026-02-12 20:02:16,758 INFO sqlalchemy.engine.Engine [generated in 0.00008s] ()
2026-02-12 20:02:16,761 INFO sqlalchemy.engine.Engine SELECT story_slides.story_id AS story_slides_story_id, story_slides.id AS story_slides_id, story_slides.title AS story_slides_title, story_slides.content AS story_slides_content, story_slides.button_text AS story_slides_button_text, story_slides.image_url AS story_slides_image_url, story_slides.button_link AS story_slides_button_link, story_slides."order" AS story_slides_order, story_slides.created_at AS story_slides_created_at, story_slides.updated_at AS story_slides_updated_at 
FROM story_slides 
WHERE story_slides.story_id IN ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::UUID) ORDER BY story_slides."order"
2026-02-12 20:02:16,761 INFO sqlalchemy.engine.Engine [generated in 0.00018s] (UUID('3803f068-cfa9-440e-814f-125be11d385a'), UUID('c2a30923-b7f9-44c3-8ffd-7812778860e0'), UUID('b1e41a9e-af0f-4ec6-bed3-6c5e6c6d0f55'), UUID('d5b94831-47cc-46c3-bc7e-643b84844601'), UUID('8e5e3fb5-99f0-43b2-a0b7-490b8120088a'), UUID('250e4d4d-7df5-4b65-808f-b37f0d9d5657'), UUID('bbeba7d8-4a97-441c-b969-b6e51081d782'))
2026-02-12 20:02:16,764 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51974 - "GET /api/v1/stories HTTP/1.1" 200 OK
INFO:     127.0.0.1:51979 - "GET /uploads/stories/customs.png HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:51980 - "GET /uploads/stories/byd.png HTTP/1.1" 404 Not Found
2026-02-12 20:02:17,549 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:17,549 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:02:17,550 INFO sqlalchemy.engine.Engine [cached since 46.58s ago] ('markup_percent',)
2026-02-12 20:02:17,552 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:02:17,552 INFO sqlalchemy.engine.Engine [cached since 46.57s ago] ()
2026-02-12 20:02:17,554 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:17,554 INFO sqlalchemy.engine.Engine [cached since 44.15s ago] (20, 0)
2026-02-12 20:02:17,556 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51974 - "GET /api/v1/cars HTTP/1.1" 200 OK
2026-02-12 20:02:18,089 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:18,090 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:18,090 INFO sqlalchemy.engine.Engine [cached since 52.43s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:18,090 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:18,090 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:18,090 INFO sqlalchemy.engine.Engine [cached since 52.43s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:18,091 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:18,091 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:02:18,091 INFO sqlalchemy.engine.Engine [cached since 47.12s ago] ('markup_percent',)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:18,093 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:02:18,093 INFO sqlalchemy.engine.Engine [cached since 44.7s ago] ('OPERATOR', 100, 0)
2026-02-12 20:02:18,094 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:18,095 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:18,095 INFO sqlalchemy.engine.Engine [cached since 52.41s ago] ()
2026-02-12 20:02:18,095 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:02:18,096 INFO sqlalchemy.engine.Engine [cached since 47.12s ago] ()
2026-02-12 20:02:18,096 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:18,096 INFO sqlalchemy.engine.Engine [cached since 44.69s ago] (50, 0)
2026-02-12 20:02:18,097 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:18,097 INFO sqlalchemy.engine.Engine [cached since 44.7s ago] (20, 0)
INFO:     127.0.0.1:51976 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:02:18,098 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:18,100 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51982 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51974 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 20:02:18,102 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:18,102 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:18,102 INFO sqlalchemy.engine.Engine [cached since 52.44s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:18,103 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:02:18,103 INFO sqlalchemy.engine.Engine [cached since 44.71s ago] ('MANAGER', 100, 0)
2026-02-12 20:02:18,104 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51976 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:02:21,385 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:21,386 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:21,386 INFO sqlalchemy.engine.Engine [cached since 55.72s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:21,389 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:21,389 INFO sqlalchemy.engine.Engine [generated in 0.00022s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:21,393 INFO sqlalchemy.engine.Engine UPDATE applications SET operator_id=$1::UUID, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 20:02:21,393 INFO sqlalchemy.engine.Engine [generated in 0.00032s] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), datetime.datetime(2026, 2, 12, 15, 2, 21, 393772), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 20:02:21,397 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 20:02:21,397 INFO sqlalchemy.engine.Engine [generated in 0.00031s] (UUID('3015a2a3-df05-40b6-9dfd-7f7c63959cec'), UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), None, 'application_assigned', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'null', '{"operator_id": "63048648-dacc-4d94-b87f-3e1068869cdd"}', None, 'null', datetime.datetime(2026, 2, 12, 15, 2, 21, 397023))
2026-02-12 20:02:21,398 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:21,401 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:21,402 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:21,402 INFO sqlalchemy.engine.Engine [generated in 0.00013s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:21,403 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51976 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/assign HTTP/1.1" 200 OK
2026-02-12 20:02:21,409 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:21,409 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:21,409 INFO sqlalchemy.engine.Engine [cached since 55.75s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:21,410 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:21,410 INFO sqlalchemy.engine.Engine [cached since 0.02103s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:21,417 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 20:02:21,417 INFO sqlalchemy.engine.Engine [generated in 0.00023s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:21,419 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51976 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
2026-02-12 20:02:21,432 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:21,432 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:21,432 INFO sqlalchemy.engine.Engine [cached since 55.77s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:21,432 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:21,432 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:21,432 INFO sqlalchemy.engine.Engine [cached since 55.77s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:21,433 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:21,433 INFO sqlalchemy.engine.Engine [cached since 0.0441s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:21,434 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:21,434 INFO sqlalchemy.engine.Engine [cached since 0.04463s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:21,436 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 20:02:21,436 INFO sqlalchemy.engine.Engine [generated in 0.00009s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 20:02:21,437 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 20:02:21,437 INFO sqlalchemy.engine.Engine [generated in 0.00011s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 20:02:21,442 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:21,443 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51976 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:51982 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 20:02:24,688 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:24,688 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:24,688 INFO sqlalchemy.engine.Engine [cached since 59.03s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:24,691 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:24,691 INFO sqlalchemy.engine.Engine [cached since 3.302s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:24,694 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 20:02:24,694 INFO sqlalchemy.engine.Engine [generated in 0.00018s] ('CANCELLED', datetime.datetime(2026, 2, 12, 15, 2, 24, 694571), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'))
2026-02-12 20:02:24,695 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 20:02:24,695 INFO sqlalchemy.engine.Engine [cached since 3.299s ago] (UUID('2b2536bc-cf00-4f2a-ac63-8cf3ca0f8331'), UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), None, 'application_status_changed', 'application', UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), '{"status": "delivered"}', '{"status": "cancelled", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 15, 2, 24, 695797))
2026-02-12 20:02:24,698 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 20:02:24,698 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (UUID('2f7a8416-5d4d-47bf-8669-b73f49312ac2'), UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'DELIVERED', 'CANCELLED', UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), '', datetime.datetime(2026, 2, 12, 15, 2, 24, 698234))
2026-02-12 20:02:24,699 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:24,702 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:24,702 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:24,702 INFO sqlalchemy.engine.Engine [cached since 3.301s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:02:24,704 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51982 - "PATCH /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/status HTTP/1.1" 200 OK
2026-02-12 20:02:24,708 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:24,708 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:24,708 INFO sqlalchemy.engine.Engine [cached since 59.05s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:24,711 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:24,711 INFO sqlalchemy.engine.Engine [cached since 59.03s ago] ()
2026-02-12 20:02:24,712 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:24,712 INFO sqlalchemy.engine.Engine [cached since 51.31s ago] (20, 0)
2026-02-12 20:02:24,714 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51982 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 20:02:27,530 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:27,530 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:27,530 INFO sqlalchemy.engine.Engine [cached since 61.87s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:27,530 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:27,531 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:27,531 INFO sqlalchemy.engine.Engine [cached since 61.87s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:27,532 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:02:27,533 INFO sqlalchemy.engine.Engine [cached since 61.86s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:27,535 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:27,535 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ()
2026-02-12 20:02:27,536 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:02:27,536 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:02:27,537 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:27,537 INFO sqlalchemy.engine.Engine [cached since 54.14s ago] (20, 0)
2026-02-12 20:02:27,537 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:02:27,537 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ()
2026-02-12 20:02:27,538 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:02:27,538 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ()
2026-02-12 20:02:27,540 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:27,540 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:02:27,540 INFO sqlalchemy.engine.Engine [cached since 61.86s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:02:27,541 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:02:27,541 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ('CANCELLED',)
INFO:     127.0.0.1:51987 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:02:27,542 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:02:27,542 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] (5,)
2026-02-12 20:02:27,543 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:02:27,543 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ()
2026-02-12 20:02:27,544 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:02:27,544 INFO sqlalchemy.engine.Engine [cached since 61.85s ago] ()
2026-02-12 20:02:27,545 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51982 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 20:02:32,194 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:32,194 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:32,194 INFO sqlalchemy.engine.Engine [cached since 66.53s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:32,195 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings
2026-02-12 20:02:32,195 INFO sqlalchemy.engine.Engine [cached since 21.61s ago] ()
2026-02-12 20:02:32,196 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51982 - "GET /api/v1/admin/settings HTTP/1.1" 200 OK
2026-02-12 20:02:34,314 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:34,314 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:34,314 INFO sqlalchemy.engine.Engine [cached since 68.65s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:34,315 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:34,315 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:34,315 INFO sqlalchemy.engine.Engine [cached since 68.65s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:34,316 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:02:34,316 INFO sqlalchemy.engine.Engine [cached since 60.92s ago] ('OPERATOR', 100, 0)
2026-02-12 20:02:34,317 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:34,317 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:02:34,317 INFO sqlalchemy.engine.Engine [cached since 63.34s ago] ('markup_percent',)
2026-02-12 20:02:34,318 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:34,319 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:34,319 INFO sqlalchemy.engine.Engine [cached since 68.64s ago] ()
INFO:     127.0.0.1:51990 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:02:34,320 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:34,320 INFO sqlalchemy.engine.Engine [cached since 60.92s ago] (20, 0)
2026-02-12 20:02:34,321 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:02:34,321 INFO sqlalchemy.engine.Engine [cached since 63.34s ago] ()
2026-02-12 20:02:34,322 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:34,322 INFO sqlalchemy.engine.Engine [cached since 60.92s ago] (50, 0)
2026-02-12 20:02:34,324 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:34,325 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51982 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:51991 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 20:02:34,327 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:34,327 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:34,327 INFO sqlalchemy.engine.Engine [cached since 68.67s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:34,329 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:02:34,329 INFO sqlalchemy.engine.Engine [cached since 60.93s ago] ('MANAGER', 100, 0)
2026-02-12 20:02:34,329 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51990 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:02:37,178 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:37,179 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:37,179 INFO sqlalchemy.engine.Engine [cached since 71.52s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:37,180 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:37,180 INFO sqlalchemy.engine.Engine [cached since 15.79s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 20:02:37,181 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 20:02:37,182 INFO sqlalchemy.engine.Engine [cached since 15.76s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 20:02:37,183 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51990 - "GET /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/comments HTTP/1.1" 200 OK
2026-02-12 20:02:37,194 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:37,194 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:37,194 INFO sqlalchemy.engine.Engine [cached since 71.53s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:37,194 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:37,194 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:37,194 INFO sqlalchemy.engine.Engine [cached since 71.53s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:37,195 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:37,195 INFO sqlalchemy.engine.Engine [cached since 15.81s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:37,196 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:37,196 INFO sqlalchemy.engine.Engine [cached since 15.81s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 20:02:37,196 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 20:02:37,196 INFO sqlalchemy.engine.Engine [cached since 15.76s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'VIDEO_SIGNATURE')
2026-02-12 20:02:37,197 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 20:02:37,197 INFO sqlalchemy.engine.Engine [cached since 15.76s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'VIDEO_SIGNATURE')
2026-02-12 20:02:37,197 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51990 - "GET /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/documents HTTP/1.1" 200 OK
2026-02-12 20:02:37,201 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51991 - "GET /api/v1/documents/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/videos HTTP/1.1" 200 OK
2026-02-12 20:02:40,338 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:40,339 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:40,339 INFO sqlalchemy.engine.Engine [cached since 74.68s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:40,342 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:40,342 INFO sqlalchemy.engine.Engine [cached since 18.95s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 20:02:40,344 INFO sqlalchemy.engine.Engine UPDATE applications SET status=$1::applicationstatus, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE applications.id = $3::UUID
2026-02-12 20:02:40,344 INFO sqlalchemy.engine.Engine [cached since 15.65s ago] ('CANCELLED', datetime.datetime(2026, 2, 12, 15, 2, 40, 344661), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'))
2026-02-12 20:02:40,346 INFO sqlalchemy.engine.Engine INSERT INTO audit_logs (id, user_id, ip_address, action, entity_type, entity_id, old_value, new_value, reason, details, created_at) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::UUID, $7::JSON, $8::JSON, $9::VARCHAR, $10::JSON, $11::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 20:02:40,346 INFO sqlalchemy.engine.Engine [cached since 18.95s ago] (UUID('bc212596-db75-4edf-8514-1a0bc8ba3e6c'), UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), None, 'application_status_changed', 'application', UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), '{"status": "delivered"}', '{"status": "cancelled", "reason": "\\u041e\\u0431\\u043d\\u043e\\u0432\\u043b\\u0435\\u043d\\u043e"}', None, 'null', datetime.datetime(2026, 2, 12, 15, 2, 40, 345981))
2026-02-12 20:02:40,346 INFO sqlalchemy.engine.Engine INSERT INTO application_status_history (id, application_id, old_status, new_status, changed_by, reason, created_at) VALUES ($1::UUID, $2::UUID, $3::applicationstatus, $4::applicationstatus, $5::UUID, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
2026-02-12 20:02:40,346 INFO sqlalchemy.engine.Engine [cached since 15.65s ago] (UUID('7986a14c-1f2a-483c-a0c2-f8d6e8d4e01d'), UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'), 'DELIVERED', 'CANCELLED', UUID('63048648-dacc-4d94-b87f-3e1068869cdd'), '', datetime.datetime(2026, 2, 12, 15, 2, 40, 346851))
2026-02-12 20:02:40,348 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:40,350 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:40,350 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:02:40,350 INFO sqlalchemy.engine.Engine [cached since 18.95s ago] (UUID('9a304c69-3aa0-4328-96a7-33a701bb8816'),)
2026-02-12 20:02:40,351 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51991 - "PATCH /api/v1/applications/9a304c69-3aa0-4328-96a7-33a701bb8816/status HTTP/1.1" 200 OK
2026-02-12 20:02:40,358 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:40,359 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:40,359 INFO sqlalchemy.engine.Engine [cached since 74.7s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:40,361 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:40,361 INFO sqlalchemy.engine.Engine [cached since 74.68s ago] ()
2026-02-12 20:02:40,362 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:40,362 INFO sqlalchemy.engine.Engine [cached since 66.96s ago] (20, 0)
2026-02-12 20:02:40,365 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51991 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 20:02:44,999 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:45,000 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:45,000 INFO sqlalchemy.engine.Engine [cached since 79.34s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:02:45,000 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:02:45,000 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:02:45,000 INFO sqlalchemy.engine.Engine [cached since 79.34s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:45,002 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:02:45,002 INFO sqlalchemy.engine.Engine [cached since 79.33s ago] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:02:45,004 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:02:45,004 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:02:45,005 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:02:45,005 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] ()
2026-02-12 20:02:45,005 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:02:45,006 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] ()
2026-02-12 20:02:45,007 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:02:45,007 INFO sqlalchemy.engine.Engine [cached since 71.61s ago] (20, 0)
2026-02-12 20:02:45,007 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:02:45,007 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] ()
2026-02-12 20:02:45,008 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:02:45,008 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:02:45,010 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:02:45,010 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:02:45,010 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] ('CANCELLED',)
2026-02-12 20:02:45,011 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:02:45,011 INFO sqlalchemy.engine.Engine [cached since 79.32s ago] (5,)
INFO:     127.0.0.1:51994 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:02:45,012 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:02:45,012 INFO sqlalchemy.engine.Engine [cached since 79.31s ago] ()
2026-02-12 20:02:45,013 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:02:45,013 INFO sqlalchemy.engine.Engine [cached since 79.31s ago] ()
2026-02-12 20:02:45,014 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:51991 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/api/admin.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [38364]
Process SpawnProcess-5:
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/uvicorn/_subprocess.py", line 78, in subprocess_started
    target(sockets=sockets)
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/uvicorn/server.py", line 62, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/uvicorn/server.py", line 69, in serve
    config.load()
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/uvicorn/config.py", line 458, in load
    self.loaded_app = import_from_string(self.app)
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/uvicorn/importer.py", line 21, in import_from_string
    module = importlib.import_module(module_str)
  File "/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py", line 127, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1030, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1007, in _find_and_load
  File "<frozen importlib._bootstrap>", line 986, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 680, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 850, in exec_module
  File "<frozen importlib._bootstrap>", line 228, in _call_with_frames_removed
  File "/Users/ula/Desktop/stl-admin/backend/app/main.py", line 10, in <module>
    from .api import auth, users, cars, applications, payments, documents, blacklist, admin, stories, admin_stories
  File "/Users/ula/Desktop/stl-admin/backend/app/api/admin.py", line 359
    async def get_staff_performance(
    ^
SyntaxError: invalid syntax
WARNING:  WatchFiles detected changes in 'app/api/admin.py'. Reloading...
INFO:     Started server process [38450]
INFO:     Waiting for application startup.
2026-02-12 20:05:12,358 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2026-02-12 20:05:12,358 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 20:05:12,359 INFO sqlalchemy.engine.Engine select current_schema()
2026-02-12 20:05:12,359 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 20:05:12,360 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2026-02-12 20:05:12,360 INFO sqlalchemy.engine.Engine [raw sql] ()
2026-02-12 20:05:12,361 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:12,362 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,362 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,365 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,366 INFO sqlalchemy.engine.Engine [cached since 0.003434s ago] ('cars_catalog', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,366 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,366 INFO sqlalchemy.engine.Engine [cached since 0.003865s ago] ('cars_price_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,366 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,366 INFO sqlalchemy.engine.Engine [cached since 0.004114s ago] ('applications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,367 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,367 INFO sqlalchemy.engine.Engine [cached since 0.004517s ago] ('application_status_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,367 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,367 INFO sqlalchemy.engine.Engine [cached since 0.005072s ago] ('application_comments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine [cached since 0.005449s ago] ('audit_logs', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine [cached since 0.005679s ago] ('settings', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine [cached since 0.005896s ago] ('blacklist', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine [cached since 0.006121s ago] ('documents', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,368 INFO sqlalchemy.engine.Engine [cached since 0.006329s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,369 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,369 INFO sqlalchemy.engine.Engine [cached since 0.006538s ago] ('stories', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,369 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-12 20:05:12,369 INFO sqlalchemy.engine.Engine [cached since 0.006754s ago] ('story_slides', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-12 20:05:12,370 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,370 INFO sqlalchemy.engine.Engine [generated in 0.00006s] ('role', 'pg_catalog')
2026-02-12 20:05:12,371 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,371 INFO sqlalchemy.engine.Engine [cached since 0.0009912s ago] ('applicationstatus', 'pg_catalog')
2026-02-12 20:05:12,371 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,371 INFO sqlalchemy.engine.Engine [cached since 0.001532s ago] ('contactstatus', 'pg_catalog')
2026-02-12 20:05:12,372 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,372 INFO sqlalchemy.engine.Engine [cached since 0.002038s ago] ('rejectionreason', 'pg_catalog')
2026-02-12 20:05:12,372 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,372 INFO sqlalchemy.engine.Engine [cached since 0.002557s ago] ('blacklistreason', 'pg_catalog')
2026-02-12 20:05:12,373 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,373 INFO sqlalchemy.engine.Engine [cached since 0.003015s ago] ('blocktype', 'pg_catalog')
2026-02-12 20:05:12,373 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,373 INFO sqlalchemy.engine.Engine [cached since 0.003507s ago] ('documenttype', 'pg_catalog')
2026-02-12 20:05:12,373 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,373 INFO sqlalchemy.engine.Engine [cached since 0.00387s ago] ('paymentmethod', 'pg_catalog')
2026-02-12 20:05:12,374 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-12 20:05:12,374 INFO sqlalchemy.engine.Engine [cached since 0.004222s ago] ('paymentstatus', 'pg_catalog')
2026-02-12 20:05:12,374 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
INFO:     127.0.0.1:52043 - "OPTIONS /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:52044 - "OPTIONS /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:05:20,901 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:20,916 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:05:20,916 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:05:20,921 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:20,921 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:05:20,921 INFO sqlalchemy.engine.Engine [cached since 0.005262s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:05:20,928 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:05:20,928 INFO sqlalchemy.engine.Engine [generated in 0.00015s] (0, 'DELIVERED', 'COMPLETED')
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:05:20,935 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:05:20,935 INFO sqlalchemy.engine.Engine [generated in 0.00013s] ()
2026-02-12 20:05:20,936 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:05:20,936 INFO sqlalchemy.engine.Engine [generated in 0.00009s] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:05:20,937 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:05:20,937 INFO sqlalchemy.engine.Engine [generated in 0.00004s] ()
2026-02-12 20:05:20,940 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:05:20,940 INFO sqlalchemy.engine.Engine [generated in 0.00009s] (20, 0)
2026-02-12 20:05:20,941 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:05:20,941 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ()
2026-02-12 20:05:20,942 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:05:20,942 INFO sqlalchemy.engine.Engine [cached since 0.005849s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:05:20,942 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:05:20,942 INFO sqlalchemy.engine.Engine [generated in 0.00011s] ('CANCELLED',)
2026-02-12 20:05:20,944 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:05:20,944 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (5,)
2026-02-12 20:05:20,946 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:05:20,947 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:05:20,947 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ()
INFO:     127.0.0.1:52044 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:05:20,948 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:05:20,948 INFO sqlalchemy.engine.Engine [generated in 0.00005s] ()
2026-02-12 20:05:20,951 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52043 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
2026-02-12 20:05:33,520 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:33,520 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:05:33,520 INFO sqlalchemy.engine.Engine [cached since 12.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:05:33,520 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:33,520 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:05:33,520 INFO sqlalchemy.engine.Engine [cached since 12.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:05:33,521 INFO sqlalchemy.engine.Engine SELECT sum(applications.final_price) AS revenue, sum(applications.final_price - coalesce(applications.source_price_snapshot, $1::INTEGER)) AS profit 
FROM applications 
WHERE applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:05:33,521 INFO sqlalchemy.engine.Engine [cached since 12.59s ago] (0, 'DELIVERED', 'COMPLETED')
2026-02-12 20:05:33,522 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:05:33,522 INFO sqlalchemy.engine.Engine [cached since 12.59s ago] ()
2026-02-12 20:05:33,523 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus)
2026-02-12 20:05:33,523 INFO sqlalchemy.engine.Engine [cached since 12.59s ago] ('NEW', 'CONFIRMED', 'CONTRACT_SIGNED', 'PAID', 'IN_TRANSIT', 'WAITING_PAYMENT')
2026-02-12 20:05:33,525 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:05:33,525 INFO sqlalchemy.engine.Engine [generated in 0.00005s] (20, 0)
2026-02-12 20:05:33,525 INFO sqlalchemy.engine.Engine SELECT count(cars_catalog.id) AS count_1 
FROM cars_catalog 
WHERE cars_catalog.is_active = true
2026-02-12 20:05:33,526 INFO sqlalchemy.engine.Engine [cached since 12.59s ago] ()
2026-02-12 20:05:33,526 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications
2026-02-12 20:05:33,526 INFO sqlalchemy.engine.Engine [cached since 12.59s ago] ()
2026-02-12 20:05:33,527 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status IN ($1::applicationstatus, $2::applicationstatus)
2026-02-12 20:05:33,527 INFO sqlalchemy.engine.Engine [cached since 12.59s ago] ('COMPLETED', 'DELIVERED')
2026-02-12 20:05:33,527 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.status = $1::applicationstatus
2026-02-12 20:05:33,527 INFO sqlalchemy.engine.Engine [cached since 12.58s ago] ('CANCELLED',)
2026-02-12 20:05:33,527 INFO sqlalchemy.engine.Engine SELECT audit_logs.id, audit_logs.user_id, audit_logs.ip_address, audit_logs.action, audit_logs.entity_type, audit_logs.entity_id, audit_logs.old_value, audit_logs.new_value, audit_logs.reason, audit_logs.details, audit_logs.created_at 
FROM audit_logs ORDER BY audit_logs.created_at DESC 
 LIMIT $1::INTEGER
2026-02-12 20:05:33,527 INFO sqlalchemy.engine.Engine [cached since 12.58s ago] (5,)
2026-02-12 20:05:33,529 INFO sqlalchemy.engine.Engine SELECT applications.status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.status
2026-02-12 20:05:33,529 INFO sqlalchemy.engine.Engine [cached since 12.58s ago] ()
2026-02-12 20:05:33,530 INFO sqlalchemy.engine.Engine SELECT applications.contact_status, count(applications.id) AS count_1 
FROM applications GROUP BY applications.contact_status
2026-02-12 20:05:33,530 INFO sqlalchemy.engine.Engine [cached since 12.58s ago] ()
2026-02-12 20:05:33,531 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:05:33,532 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52047 - "GET /api/v1/admin/stats?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:52048 - "GET /api/v1/applications?limit=5 HTTP/1.1" 200 OK
2026-02-12 20:05:35,017 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:35,018 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:05:35,018 INFO sqlalchemy.engine.Engine [generated in 0.00022s] ('markup_percent',)
2026-02-12 20:05:35,023 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:05:35,023 INFO sqlalchemy.engine.Engine [generated in 0.00023s] ()
2026-02-12 20:05:35,026 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:05:35,026 INFO sqlalchemy.engine.Engine [generated in 0.00050s] (20, 0)
2026-02-12 20:05:35,029 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52048 - "GET /api/v1/cars HTTP/1.1" 200 OK
2026-02-12 20:05:38,408 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:05:38,409 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:05:38,409 INFO sqlalchemy.engine.Engine [cached since 17.49s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:05:38,411 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:05:38,411 INFO sqlalchemy.engine.Engine [generated in 0.00021s] (20, 0)
2026-02-12 20:05:38,413 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52048 - "GET /api/v1/users HTTP/1.1" 200 OK
INFO:     127.0.0.1:52074 - "OPTIONS /api/v1/users HTTP/1.1" 200 OK
2026-02-12 20:06:23,965 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:06:23,965 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:06:23,965 INFO sqlalchemy.engine.Engine [cached since 63.05s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:06:23,967 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:06:23,967 INFO sqlalchemy.engine.Engine [cached since 45.56s ago] (20, 0)
2026-02-12 20:06:23,967 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52074 - "GET /api/v1/users HTTP/1.1" 200 OK
2026-02-12 20:07:54,133 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:07:54,133 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:07:54,134 INFO sqlalchemy.engine.Engine [cached since 153.2s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:07:54,135 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:07:54,135 INFO sqlalchemy.engine.Engine [cached since 135.7s ago] (20, 0)
2026-02-12 20:07:54,135 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52105 - "GET /api/v1/users HTTP/1.1" 200 OK
INFO:     127.0.0.1:52109 - "OPTIONS /api/v1/admin/staff/9b032fe3-25a4-4eb3-b110-f23655388cef/performance?period=all HTTP/1.1" 200 OK
2026-02-12 20:08:09,693 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:09,693 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:09,693 INFO sqlalchemy.engine.Engine [cached since 168.8s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:09,695 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:09,696 INFO sqlalchemy.engine.Engine [cached since 168.8s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 20:08:09,699 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:08:09,699 INFO sqlalchemy.engine.Engine [generated in 0.00040s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 20:08:09,701 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID ORDER BY applications.created_at DESC
2026-02-12 20:08:09,701 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 20:08:09,703 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52109 - "GET /api/v1/admin/staff/9b032fe3-25a4-4eb3-b110-f23655388cef/performance?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:52115 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa HTTP/1.1" 200 OK
2026-02-12 20:08:22,640 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:22,641 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:22,641 INFO sqlalchemy.engine.Engine [cached since 181.7s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:22,644 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:08:22,645 INFO sqlalchemy.engine.Engine [generated in 0.00046s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:08:22,651 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:08:22,651 INFO sqlalchemy.engine.Engine [generated in 0.00025s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:08:22,653 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.phone AS users_phone, users.email AS users_email, users.password_hash AS users_password_hash, users.first_name AS users_first_name, users.last_name AS users_last_name, users.role AS users_role, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id IN ($1::UUID)
2026-02-12 20:08:22,653 INFO sqlalchemy.engine.Engine [generated in 0.00028s] (UUID('f5b9a656-f83e-4878-b152-f792d088b456'),)
2026-02-12 20:08:22,656 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id AS cars_catalog_id, cars_catalog.source AS cars_catalog_source, cars_catalog.source_url AS cars_catalog_source_url, cars_catalog.external_id AS cars_catalog_external_id, cars_catalog.brand AS cars_catalog_brand, cars_catalog.make AS cars_catalog_make, cars_catalog.model AS cars_catalog_model, cars_catalog.year AS cars_catalog_year, cars_catalog.trim AS cars_catalog_trim, cars_catalog.body_type AS cars_catalog_body_type, cars_catalog.mileage AS cars_catalog_mileage, cars_catalog.exterior_color AS cars_catalog_exterior_color, cars_catalog.interior_color AS cars_catalog_interior_color, cars_catalog.transmission AS cars_catalog_transmission, cars_catalog.drivetrain AS cars_catalog_drivetrain, cars_catalog.fuel_type AS cars_catalog_fuel_type, cars_catalog.engine AS cars_catalog_engine, cars_catalog.mpg_city AS cars_catalog_mpg_city, cars_catalog.mpg_highway AS cars_catalog_mpg_highway, cars_catalog.vin AS cars_catalog_vin, cars_catalog.source_price_usd AS cars_catalog_source_price_usd, cars_catalog.final_price_usd AS cars_catalog_final_price_usd, cars_catalog.dealer AS cars_catalog_dealer, cars_catalog.location_city AS cars_catalog_location_city, cars_catalog.location_state AS cars_catalog_location_state, cars_catalog.location AS cars_catalog_location, cars_catalog.image_url AS cars_catalog_image_url, cars_catalog.photos AS cars_catalog_photos, cars_catalog.features AS cars_catalog_features, cars_catalog.status AS cars_catalog_status, cars_catalog.is_active AS cars_catalog_is_active, cars_catalog.parsed_at AS cars_catalog_parsed_at, cars_catalog.last_seen_at AS cars_catalog_last_seen_at, cars_catalog.source_updated_at AS cars_catalog_source_updated_at, cars_catalog.created_at AS cars_catalog_created_at, cars_catalog.updated_at AS cars_catalog_updated_at 
FROM cars_catalog 
WHERE cars_catalog.id IN ($1::UUID)
2026-02-12 20:08:22,656 INFO sqlalchemy.engine.Engine [generated in 0.00018s] (UUID('9adbb5c6-45e1-4840-b319-42885d4df85b'),)
2026-02-12 20:08:22,661 INFO sqlalchemy.engine.Engine SELECT payments.application_id AS payments_application_id, payments.id AS payments_id, payments.invoice_number AS payments_invoice_number, payments.amount AS payments_amount, payments.method AS payments_method, payments.receipt_file_path AS payments_receipt_file_path, payments.status AS payments_status, payments.confirmed_by AS payments_confirmed_by, payments.confirmed_at AS payments_confirmed_at, payments.rejection_reason AS payments_rejection_reason, payments.created_by AS payments_created_by, payments.created_at AS payments_created_at, payments.updated_at AS payments_updated_at 
FROM payments 
WHERE payments.application_id IN ($1::UUID)
2026-02-12 20:08:22,662 INFO sqlalchemy.engine.Engine [generated in 0.00032s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:08:22,672 INFO sqlalchemy.engine.Engine SELECT documents.application_id AS documents_application_id, documents.id AS documents_id, documents.type AS documents_type, documents.file_path AS documents_file_path, documents.original_filename AS documents_original_filename, documents.mime_type AS documents_mime_type, documents.file_size AS documents_file_size, documents.file_hash AS documents_file_hash, documents.uploaded_by AS documents_uploaded_by, documents.version AS documents_version, documents.created_at AS documents_created_at 
FROM documents 
WHERE documents.application_id IN ($1::UUID)
2026-02-12 20:08:22,672 INFO sqlalchemy.engine.Engine [generated in 0.00028s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:08:22,685 INFO sqlalchemy.engine.Engine SELECT application_status_history.application_id AS application_status_history_application_id, application_status_history.id AS application_status_history_id, application_status_history.old_status AS application_status_history_old_status, application_status_history.new_status AS application_status_history_new_status, application_status_history.changed_by AS application_status_history_changed_by, application_status_history.reason AS application_status_history_reason, application_status_history.created_at AS application_status_history_created_at 
FROM application_status_history 
WHERE application_status_history.application_id IN ($1::UUID) ORDER BY application_status_history.created_at DESC
2026-02-12 20:08:22,686 INFO sqlalchemy.engine.Engine [generated in 0.00031s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:08:22,689 INFO sqlalchemy.engine.Engine SELECT application_comments.application_id AS application_comments_application_id, application_comments.id AS application_comments_id, application_comments.user_id AS application_comments_user_id, application_comments.text AS application_comments_text, application_comments.is_internal AS application_comments_is_internal, application_comments.created_at AS application_comments_created_at 
FROM application_comments 
WHERE application_comments.application_id IN ($1::UUID) ORDER BY application_comments.created_at DESC
2026-02-12 20:08:22,689 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:08:22,691 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:08:22,691 INFO sqlalchemy.engine.Engine [cached since 167.7s ago] ('markup_percent',)
2026-02-12 20:08:22,693 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52115 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa HTTP/1.1" 200 OK
INFO:     127.0.0.1:52115 - "OPTIONS /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:52117 - "OPTIONS /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:52122 - "OPTIONS /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 20:08:26,997 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:26,997 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:26,997 INFO sqlalchemy.engine.Engine [cached since 186.1s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:08:26,998 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:26,998 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:26,998 INFO sqlalchemy.engine.Engine [cached since 186.1s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:27,001 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:08:27,001 INFO sqlalchemy.engine.Engine [generated in 0.00018s] ('OPERATOR', 100, 0)
2026-02-12 20:08:27,001 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:08:27,002 INFO sqlalchemy.engine.Engine [cached since 186.1s ago] ()
2026-02-12 20:08:27,002 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:08:27,002 INFO sqlalchemy.engine.Engine [cached since 173.5s ago] (20, 0)
2026-02-12 20:08:27,003 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:08:27,005 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52124 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:52115 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 20:08:27,006 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:27,007 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:08:27,007 INFO sqlalchemy.engine.Engine [cached since 172s ago] ('markup_percent',)
2026-02-12 20:08:27,009 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:08:27,009 INFO sqlalchemy.engine.Engine [cached since 172s ago] ()
INFO:     127.0.0.1:52115 - "OPTIONS /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:08:27,010 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:27,010 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:27,010 INFO sqlalchemy.engine.Engine [cached since 186.1s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:08:27,011 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:08:27,011 INFO sqlalchemy.engine.Engine [generated in 0.00008s] (50, 0)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:27,012 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:08:27,012 INFO sqlalchemy.engine.Engine [cached since 0.01146s ago] ('MANAGER', 100, 0)
2026-02-12 20:08:27,012 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:08:27,013 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52124 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
INFO:     127.0.0.1:52117 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 20:08:35,357 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:35,357 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:35,357 INFO sqlalchemy.engine.Engine [cached since 194.4s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:35,359 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:08:35,359 INFO sqlalchemy.engine.Engine [cached since 176.9s ago] (20, 0)
2026-02-12 20:08:35,360 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52128 - "GET /api/v1/users HTTP/1.1" 200 OK
INFO:     127.0.0.1:52128 - "OPTIONS /api/v1/admin/staff/7bffe1f0-915c-4995-85fe-cf95a541ed2a/performance?period=all HTTP/1.1" 200 OK
2026-02-12 20:08:37,929 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:37,929 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:37,929 INFO sqlalchemy.engine.Engine [cached since 197s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:37,931 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:37,932 INFO sqlalchemy.engine.Engine [cached since 197s ago] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 20:08:37,934 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.operator_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus, $4::applicationstatus, $5::applicationstatus, $6::applicationstatus, $7::applicationstatus, $8::applicationstatus, $9::applicationstatus, $10::applicationstatus, $11::applicationstatus)
2026-02-12 20:08:37,934 INFO sqlalchemy.engine.Engine [generated in 0.00034s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'), 'IN_CALLCENTER', 'CONFIRMED', 'WAITING_VISIT', 'WAITING_PAYMENT', 'PAID', 'CONTRACT_SIGNED', 'CARGO_BOOKED', 'IN_TRANSIT', 'DELIVERED', 'COMPLETED')
2026-02-12 20:08:37,937 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.operator_id = $1::UUID ORDER BY applications.created_at DESC
2026-02-12 20:08:37,937 INFO sqlalchemy.engine.Engine [generated in 0.00015s] (UUID('7bffe1f0-915c-4995-85fe-cf95a541ed2a'),)
2026-02-12 20:08:37,939 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52128 - "GET /api/v1/admin/staff/7bffe1f0-915c-4995-85fe-cf95a541ed2a/performance?period=all HTTP/1.1" 200 OK
INFO:     127.0.0.1:52128 - "OPTIONS /api/v1/applications/a1fae952-27eb-4d10-9a76-31fef0ba6a0b HTTP/1.1" 200 OK
2026-02-12 20:08:41,826 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:41,826 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:41,827 INFO sqlalchemy.engine.Engine [cached since 200.9s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:41,838 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:08:41,839 INFO sqlalchemy.engine.Engine [cached since 19.19s ago] (UUID('a1fae952-27eb-4d10-9a76-31fef0ba6a0b'),)
2026-02-12 20:08:41,845 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:08:41,845 INFO sqlalchemy.engine.Engine [cached since 19.19s ago] (UUID('a1fae952-27eb-4d10-9a76-31fef0ba6a0b'),)
2026-02-12 20:08:41,847 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.phone AS users_phone, users.email AS users_email, users.password_hash AS users_password_hash, users.first_name AS users_first_name, users.last_name AS users_last_name, users.role AS users_role, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id IN ($1::UUID)
2026-02-12 20:08:41,847 INFO sqlalchemy.engine.Engine [cached since 19.19s ago] (UUID('d91ed071-5a44-4bfb-a066-9b16150dbe95'),)
2026-02-12 20:08:41,850 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id AS cars_catalog_id, cars_catalog.source AS cars_catalog_source, cars_catalog.source_url AS cars_catalog_source_url, cars_catalog.external_id AS cars_catalog_external_id, cars_catalog.brand AS cars_catalog_brand, cars_catalog.make AS cars_catalog_make, cars_catalog.model AS cars_catalog_model, cars_catalog.year AS cars_catalog_year, cars_catalog.trim AS cars_catalog_trim, cars_catalog.body_type AS cars_catalog_body_type, cars_catalog.mileage AS cars_catalog_mileage, cars_catalog.exterior_color AS cars_catalog_exterior_color, cars_catalog.interior_color AS cars_catalog_interior_color, cars_catalog.transmission AS cars_catalog_transmission, cars_catalog.drivetrain AS cars_catalog_drivetrain, cars_catalog.fuel_type AS cars_catalog_fuel_type, cars_catalog.engine AS cars_catalog_engine, cars_catalog.mpg_city AS cars_catalog_mpg_city, cars_catalog.mpg_highway AS cars_catalog_mpg_highway, cars_catalog.vin AS cars_catalog_vin, cars_catalog.source_price_usd AS cars_catalog_source_price_usd, cars_catalog.final_price_usd AS cars_catalog_final_price_usd, cars_catalog.dealer AS cars_catalog_dealer, cars_catalog.location_city AS cars_catalog_location_city, cars_catalog.location_state AS cars_catalog_location_state, cars_catalog.location AS cars_catalog_location, cars_catalog.image_url AS cars_catalog_image_url, cars_catalog.photos AS cars_catalog_photos, cars_catalog.features AS cars_catalog_features, cars_catalog.status AS cars_catalog_status, cars_catalog.is_active AS cars_catalog_is_active, cars_catalog.parsed_at AS cars_catalog_parsed_at, cars_catalog.last_seen_at AS cars_catalog_last_seen_at, cars_catalog.source_updated_at AS cars_catalog_source_updated_at, cars_catalog.created_at AS cars_catalog_created_at, cars_catalog.updated_at AS cars_catalog_updated_at 
FROM cars_catalog 
WHERE cars_catalog.id IN ($1::UUID)
2026-02-12 20:08:41,850 INFO sqlalchemy.engine.Engine [cached since 19.19s ago] (UUID('43e90932-f02e-4074-8a2f-a01261a604f7'),)
2026-02-12 20:08:41,852 INFO sqlalchemy.engine.Engine SELECT payments.application_id AS payments_application_id, payments.id AS payments_id, payments.invoice_number AS payments_invoice_number, payments.amount AS payments_amount, payments.method AS payments_method, payments.receipt_file_path AS payments_receipt_file_path, payments.status AS payments_status, payments.confirmed_by AS payments_confirmed_by, payments.confirmed_at AS payments_confirmed_at, payments.rejection_reason AS payments_rejection_reason, payments.created_by AS payments_created_by, payments.created_at AS payments_created_at, payments.updated_at AS payments_updated_at 
FROM payments 
WHERE payments.application_id IN ($1::UUID)
2026-02-12 20:08:41,852 INFO sqlalchemy.engine.Engine [cached since 19.19s ago] (UUID('a1fae952-27eb-4d10-9a76-31fef0ba6a0b'),)
2026-02-12 20:08:41,859 INFO sqlalchemy.engine.Engine SELECT documents.application_id AS documents_application_id, documents.id AS documents_id, documents.type AS documents_type, documents.file_path AS documents_file_path, documents.original_filename AS documents_original_filename, documents.mime_type AS documents_mime_type, documents.file_size AS documents_file_size, documents.file_hash AS documents_file_hash, documents.uploaded_by AS documents_uploaded_by, documents.version AS documents_version, documents.created_at AS documents_created_at 
FROM documents 
WHERE documents.application_id IN ($1::UUID)
2026-02-12 20:08:41,859 INFO sqlalchemy.engine.Engine [cached since 19.19s ago] (UUID('a1fae952-27eb-4d10-9a76-31fef0ba6a0b'),)
2026-02-12 20:08:41,865 INFO sqlalchemy.engine.Engine SELECT application_status_history.application_id AS application_status_history_application_id, application_status_history.id AS application_status_history_id, application_status_history.old_status AS application_status_history_old_status, application_status_history.new_status AS application_status_history_new_status, application_status_history.changed_by AS application_status_history_changed_by, application_status_history.reason AS application_status_history_reason, application_status_history.created_at AS application_status_history_created_at 
FROM application_status_history 
WHERE application_status_history.application_id IN ($1::UUID) ORDER BY application_status_history.created_at DESC
2026-02-12 20:08:41,865 INFO sqlalchemy.engine.Engine [cached since 19.18s ago] (UUID('a1fae952-27eb-4d10-9a76-31fef0ba6a0b'),)
2026-02-12 20:08:41,869 INFO sqlalchemy.engine.Engine SELECT application_comments.application_id AS application_comments_application_id, application_comments.id AS application_comments_id, application_comments.user_id AS application_comments_user_id, application_comments.text AS application_comments_text, application_comments.is_internal AS application_comments_is_internal, application_comments.created_at AS application_comments_created_at 
FROM application_comments 
WHERE application_comments.application_id IN ($1::UUID) ORDER BY application_comments.created_at DESC
2026-02-12 20:08:41,869 INFO sqlalchemy.engine.Engine [cached since 19.18s ago] (UUID('a1fae952-27eb-4d10-9a76-31fef0ba6a0b'),)
2026-02-12 20:08:41,872 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:08:41,872 INFO sqlalchemy.engine.Engine [cached since 186.9s ago] ('markup_percent',)
2026-02-12 20:08:41,874 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52130 - "GET /api/v1/applications/a1fae952-27eb-4d10-9a76-31fef0ba6a0b HTTP/1.1" 200 OK
2026-02-12 20:08:42,848 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:42,848 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:42,848 INFO sqlalchemy.engine.Engine [cached since 201.9s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:08:42,849 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:42,849 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:42,849 INFO sqlalchemy.engine.Engine [cached since 201.9s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:42,851 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:08:42,851 INFO sqlalchemy.engine.Engine [cached since 15.85s ago] ('OPERATOR', 100, 0)
2026-02-12 20:08:42,851 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:42,852 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:08:42,852 INFO sqlalchemy.engine.Engine [cached since 187.8s ago] ('markup_percent',)
2026-02-12 20:08:42,852 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:08:42,852 INFO sqlalchemy.engine.Engine [cached since 201.9s ago] ()
2026-02-12 20:08:42,853 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:08:42,854 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:08:42,854 INFO sqlalchemy.engine.Engine [cached since 189.3s ago] (20, 0)
2026-02-12 20:08:42,854 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:08:42,854 INFO sqlalchemy.engine.Engine [cached since 187.8s ago] ()
INFO:     127.0.0.1:52128 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:08:42,855 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:08:42,855 INFO sqlalchemy.engine.Engine [cached since 15.84s ago] (50, 0)
2026-02-12 20:08:42,857 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:08:42,858 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52130 - "GET /api/v1/applications HTTP/1.1" 200 OK
INFO:     127.0.0.1:52132 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 20:08:42,859 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:08:42,860 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:08:42,860 INFO sqlalchemy.engine.Engine [cached since 201.9s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:08:42,861 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:08:42,861 INFO sqlalchemy.engine.Engine [cached since 15.86s ago] ('MANAGER', 100, 0)
2026-02-12 20:08:42,861 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52128 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:09:40,032 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:40,033 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:40,033 INFO sqlalchemy.engine.Engine [cached since 259.1s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:09:40,034 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users ORDER BY users.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:09:40,034 INFO sqlalchemy.engine.Engine [cached since 241.6s ago] (20, 0)
2026-02-12 20:09:40,035 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52152 - "GET /api/v1/users HTTP/1.1" 200 OK
2026-02-12 20:09:42,124 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:42,124 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:42,124 INFO sqlalchemy.engine.Engine [cached since 261.2s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:09:42,126 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:42,126 INFO sqlalchemy.engine.Engine [cached since 261.2s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 20:09:42,127 INFO sqlalchemy.engine.Engine SELECT count(applications.id) AS count_1 
FROM applications 
WHERE applications.manager_id = $1::UUID AND applications.status IN ($2::applicationstatus, $3::applicationstatus)
2026-02-12 20:09:42,127 INFO sqlalchemy.engine.Engine [cached since 92.43s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'), 'DELIVERED', 'COMPLETED')
2026-02-12 20:09:42,129 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.manager_id = $1::UUID ORDER BY applications.created_at DESC
2026-02-12 20:09:42,129 INFO sqlalchemy.engine.Engine [cached since 92.43s ago] (UUID('9b032fe3-25a4-4eb3-b110-f23655388cef'),)
2026-02-12 20:09:42,130 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52152 - "GET /api/v1/admin/staff/9b032fe3-25a4-4eb3-b110-f23655388cef/performance?period=all HTTP/1.1" 200 OK
2026-02-12 20:09:44,558 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:44,559 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:44,560 INFO sqlalchemy.engine.Engine [cached since 263.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:09:44,562 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:09:44,562 INFO sqlalchemy.engine.Engine [cached since 81.92s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:09:44,563 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:09:44,564 INFO sqlalchemy.engine.Engine [cached since 81.91s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:09:44,565 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.phone AS users_phone, users.email AS users_email, users.password_hash AS users_password_hash, users.first_name AS users_first_name, users.last_name AS users_last_name, users.role AS users_role, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id IN ($1::UUID)
2026-02-12 20:09:44,565 INFO sqlalchemy.engine.Engine [cached since 81.91s ago] (UUID('f5b9a656-f83e-4878-b152-f792d088b456'),)
2026-02-12 20:09:44,567 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id AS cars_catalog_id, cars_catalog.source AS cars_catalog_source, cars_catalog.source_url AS cars_catalog_source_url, cars_catalog.external_id AS cars_catalog_external_id, cars_catalog.brand AS cars_catalog_brand, cars_catalog.make AS cars_catalog_make, cars_catalog.model AS cars_catalog_model, cars_catalog.year AS cars_catalog_year, cars_catalog.trim AS cars_catalog_trim, cars_catalog.body_type AS cars_catalog_body_type, cars_catalog.mileage AS cars_catalog_mileage, cars_catalog.exterior_color AS cars_catalog_exterior_color, cars_catalog.interior_color AS cars_catalog_interior_color, cars_catalog.transmission AS cars_catalog_transmission, cars_catalog.drivetrain AS cars_catalog_drivetrain, cars_catalog.fuel_type AS cars_catalog_fuel_type, cars_catalog.engine AS cars_catalog_engine, cars_catalog.mpg_city AS cars_catalog_mpg_city, cars_catalog.mpg_highway AS cars_catalog_mpg_highway, cars_catalog.vin AS cars_catalog_vin, cars_catalog.source_price_usd AS cars_catalog_source_price_usd, cars_catalog.final_price_usd AS cars_catalog_final_price_usd, cars_catalog.dealer AS cars_catalog_dealer, cars_catalog.location_city AS cars_catalog_location_city, cars_catalog.location_state AS cars_catalog_location_state, cars_catalog.location AS cars_catalog_location, cars_catalog.image_url AS cars_catalog_image_url, cars_catalog.photos AS cars_catalog_photos, cars_catalog.features AS cars_catalog_features, cars_catalog.status AS cars_catalog_status, cars_catalog.is_active AS cars_catalog_is_active, cars_catalog.parsed_at AS cars_catalog_parsed_at, cars_catalog.last_seen_at AS cars_catalog_last_seen_at, cars_catalog.source_updated_at AS cars_catalog_source_updated_at, cars_catalog.created_at AS cars_catalog_created_at, cars_catalog.updated_at AS cars_catalog_updated_at 
FROM cars_catalog 
WHERE cars_catalog.id IN ($1::UUID)
2026-02-12 20:09:44,567 INFO sqlalchemy.engine.Engine [cached since 81.91s ago] (UUID('9adbb5c6-45e1-4840-b319-42885d4df85b'),)
2026-02-12 20:09:44,569 INFO sqlalchemy.engine.Engine SELECT payments.application_id AS payments_application_id, payments.id AS payments_id, payments.invoice_number AS payments_invoice_number, payments.amount AS payments_amount, payments.method AS payments_method, payments.receipt_file_path AS payments_receipt_file_path, payments.status AS payments_status, payments.confirmed_by AS payments_confirmed_by, payments.confirmed_at AS payments_confirmed_at, payments.rejection_reason AS payments_rejection_reason, payments.created_by AS payments_created_by, payments.created_at AS payments_created_at, payments.updated_at AS payments_updated_at 
FROM payments 
WHERE payments.application_id IN ($1::UUID)
2026-02-12 20:09:44,569 INFO sqlalchemy.engine.Engine [cached since 81.91s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:09:44,570 INFO sqlalchemy.engine.Engine SELECT documents.application_id AS documents_application_id, documents.id AS documents_id, documents.type AS documents_type, documents.file_path AS documents_file_path, documents.original_filename AS documents_original_filename, documents.mime_type AS documents_mime_type, documents.file_size AS documents_file_size, documents.file_hash AS documents_file_hash, documents.uploaded_by AS documents_uploaded_by, documents.version AS documents_version, documents.created_at AS documents_created_at 
FROM documents 
WHERE documents.application_id IN ($1::UUID)
2026-02-12 20:09:44,570 INFO sqlalchemy.engine.Engine [cached since 81.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:09:44,571 INFO sqlalchemy.engine.Engine SELECT application_status_history.application_id AS application_status_history_application_id, application_status_history.id AS application_status_history_id, application_status_history.old_status AS application_status_history_old_status, application_status_history.new_status AS application_status_history_new_status, application_status_history.changed_by AS application_status_history_changed_by, application_status_history.reason AS application_status_history_reason, application_status_history.created_at AS application_status_history_created_at 
FROM application_status_history 
WHERE application_status_history.application_id IN ($1::UUID) ORDER BY application_status_history.created_at DESC
2026-02-12 20:09:44,571 INFO sqlalchemy.engine.Engine [cached since 81.89s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:09:44,572 INFO sqlalchemy.engine.Engine SELECT application_comments.application_id AS application_comments_application_id, application_comments.id AS application_comments_id, application_comments.user_id AS application_comments_user_id, application_comments.text AS application_comments_text, application_comments.is_internal AS application_comments_is_internal, application_comments.created_at AS application_comments_created_at 
FROM application_comments 
WHERE application_comments.application_id IN ($1::UUID) ORDER BY application_comments.created_at DESC
2026-02-12 20:09:44,573 INFO sqlalchemy.engine.Engine [cached since 81.88s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:09:44,574 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:09:44,574 INFO sqlalchemy.engine.Engine [cached since 249.6s ago] ('markup_percent',)
2026-02-12 20:09:44,575 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52152 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa HTTP/1.1" 200 OK
2026-02-12 20:09:47,510 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:47,510 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:47,510 INFO sqlalchemy.engine.Engine [cached since 266.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:09:47,511 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:47,511 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:47,511 INFO sqlalchemy.engine.Engine [cached since 266.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:09:47,512 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:47,513 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:09:47,513 INFO sqlalchemy.engine.Engine [cached since 252.5s ago] ('markup_percent',)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:09:47,514 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:09:47,514 INFO sqlalchemy.engine.Engine [cached since 80.51s ago] ('OPERATOR', 100, 0)
2026-02-12 20:09:47,515 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:09:47,515 INFO sqlalchemy.engine.Engine [cached since 266.6s ago] ()
2026-02-12 20:09:47,516 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:09:47,516 INFO sqlalchemy.engine.Engine [cached since 252.5s ago] ()
2026-02-12 20:09:47,517 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:09:47,517 INFO sqlalchemy.engine.Engine [cached since 254s ago] (20, 0)
2026-02-12 20:09:47,517 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52156 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:09:47,519 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:09:47,519 INFO sqlalchemy.engine.Engine [cached since 80.51s ago] (50, 0)
2026-02-12 20:09:47,520 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52152 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 20:09:47,522 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52157 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
2026-02-12 20:09:47,524 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:09:47,524 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:09:47,524 INFO sqlalchemy.engine.Engine [cached since 266.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:09:47,525 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:09:47,525 INFO sqlalchemy.engine.Engine [cached since 80.52s ago] ('MANAGER', 100, 0)
2026-02-12 20:09:47,526 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52152 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:10:49,557 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,557 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,557 INFO sqlalchemy.engine.Engine [cached since 328.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,558 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:10:49,558 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:10:49,558 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine [cached since 328.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine [cached since 328.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:10:49,559 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,560 INFO sqlalchemy.engine.Engine SELECT users.id AS users_id, users.phone AS users_phone, users.email AS users_email, users.password_hash AS users_password_hash, users.first_name AS users_first_name, users.last_name AS users_last_name, users.role AS users_role, users.is_active AS users_is_active, users.created_at AS users_created_at, users.updated_at AS users_updated_at 
FROM users 
WHERE users.id IN ($1::UUID)
2026-02-12 20:10:49,560 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('f5b9a656-f83e-4878-b152-f792d088b456'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,561 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:10:49,561 INFO sqlalchemy.engine.Engine [cached since 142.6s ago] ('OPERATOR', 100, 0)
2026-02-12 20:10:49,561 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT applications.id AS id, applications.client_id AS client_id, applications.car_id AS car_id, applications.operator_id AS operator_id, applications.manager_id AS manager_id, applications.source_price_snapshot AS source_price_snapshot, applications.markup_percent AS markup_percent, applications.final_price AS final_price, applications.status AS status, applications.contact_status AS contact_status, applications.checklist AS checklist, applications.rejection_reason AS rejection_reason, applications.rejection_note AS rejection_note, applications.operator_comment AS operator_comment, applications.internal_note AS internal_note, applications.car_confirmed AS car_confirmed, applications.car_confirmed_by AS car_confirmed_by, applications.car_confirmed_at AS car_confirmed_at, applications.cargo_booking_number AS cargo_booking_number, applications.cargo_notes AS cargo_notes, applications.created_at AS created_at, applications.updated_at AS updated_at 
FROM applications ORDER BY applications.created_at DESC) AS anon_1
2026-02-12 20:10:49,561 INFO sqlalchemy.engine.Engine [cached since 328.6s ago] ()
2026-02-12 20:10:49,561 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id AS cars_catalog_id, cars_catalog.source AS cars_catalog_source, cars_catalog.source_url AS cars_catalog_source_url, cars_catalog.external_id AS cars_catalog_external_id, cars_catalog.brand AS cars_catalog_brand, cars_catalog.make AS cars_catalog_make, cars_catalog.model AS cars_catalog_model, cars_catalog.year AS cars_catalog_year, cars_catalog.trim AS cars_catalog_trim, cars_catalog.body_type AS cars_catalog_body_type, cars_catalog.mileage AS cars_catalog_mileage, cars_catalog.exterior_color AS cars_catalog_exterior_color, cars_catalog.interior_color AS cars_catalog_interior_color, cars_catalog.transmission AS cars_catalog_transmission, cars_catalog.drivetrain AS cars_catalog_drivetrain, cars_catalog.fuel_type AS cars_catalog_fuel_type, cars_catalog.engine AS cars_catalog_engine, cars_catalog.mpg_city AS cars_catalog_mpg_city, cars_catalog.mpg_highway AS cars_catalog_mpg_highway, cars_catalog.vin AS cars_catalog_vin, cars_catalog.source_price_usd AS cars_catalog_source_price_usd, cars_catalog.final_price_usd AS cars_catalog_final_price_usd, cars_catalog.dealer AS cars_catalog_dealer, cars_catalog.location_city AS cars_catalog_location_city, cars_catalog.location_state AS cars_catalog_location_state, cars_catalog.location AS cars_catalog_location, cars_catalog.image_url AS cars_catalog_image_url, cars_catalog.photos AS cars_catalog_photos, cars_catalog.features AS cars_catalog_features, cars_catalog.status AS cars_catalog_status, cars_catalog.is_active AS cars_catalog_is_active, cars_catalog.parsed_at AS cars_catalog_parsed_at, cars_catalog.last_seen_at AS cars_catalog_last_seen_at, cars_catalog.source_updated_at AS cars_catalog_source_updated_at, cars_catalog.created_at AS cars_catalog_created_at, cars_catalog.updated_at AS cars_catalog_updated_at 
FROM cars_catalog 
WHERE cars_catalog.id IN ($1::UUID)
2026-02-12 20:10:49,561 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('9adbb5c6-45e1-4840-b319-42885d4df85b'),)
2026-02-12 20:10:49,562 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:10:49,562 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at, users_1.id AS id_1, users_1.phone, users_1.email, users_1.password_hash, users_1.first_name, users_1.last_name, users_1.role, users_1.is_active, users_1.created_at AS created_at_1, users_1.updated_at AS updated_at_1, cars_catalog_1.id AS id_2, cars_catalog_1.source, cars_catalog_1.source_url, cars_catalog_1.external_id, cars_catalog_1.brand, cars_catalog_1.make, cars_catalog_1.model, cars_catalog_1.year, cars_catalog_1.trim, cars_catalog_1.body_type, cars_catalog_1.mileage, cars_catalog_1.exterior_color, cars_catalog_1.interior_color, cars_catalog_1.transmission, cars_catalog_1.drivetrain, cars_catalog_1.fuel_type, cars_catalog_1.engine, cars_catalog_1.mpg_city, cars_catalog_1.mpg_highway, cars_catalog_1.vin, cars_catalog_1.source_price_usd, cars_catalog_1.final_price_usd, cars_catalog_1.dealer, cars_catalog_1.location_city, cars_catalog_1.location_state, cars_catalog_1.location, cars_catalog_1.image_url, cars_catalog_1.photos, cars_catalog_1.features, cars_catalog_1.status AS status_1, cars_catalog_1.is_active AS is_active_1, cars_catalog_1.parsed_at, cars_catalog_1.last_seen_at, cars_catalog_1.source_updated_at, cars_catalog_1.created_at AS created_at_2, cars_catalog_1.updated_at AS updated_at_2 
FROM applications LEFT OUTER JOIN users AS users_1 ON users_1.id = applications.client_id LEFT OUTER JOIN cars_catalog AS cars_catalog_1 ON cars_catalog_1.id = applications.car_id ORDER BY applications.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:10:49,562 INFO sqlalchemy.engine.Engine [cached since 316s ago] (20, 0)
2026-02-12 20:10:49,562 INFO sqlalchemy.engine.Engine SELECT payments.application_id AS payments_application_id, payments.id AS payments_id, payments.invoice_number AS payments_invoice_number, payments.amount AS payments_amount, payments.method AS payments_method, payments.receipt_file_path AS payments_receipt_file_path, payments.status AS payments_status, payments.confirmed_by AS payments_confirmed_by, payments.confirmed_at AS payments_confirmed_at, payments.rejection_reason AS payments_rejection_reason, payments.created_by AS payments_created_by, payments.created_at AS payments_created_at, payments.updated_at AS payments_updated_at 
FROM payments 
WHERE payments.application_id IN ($1::UUID)
2026-02-12 20:10:49,562 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
INFO:     127.0.0.1:52176 - "GET /api/v1/users?role=operator&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:10:49,563 INFO sqlalchemy.engine.Engine SELECT documents.application_id AS documents_application_id, documents.id AS documents_id, documents.type AS documents_type, documents.file_path AS documents_file_path, documents.original_filename AS documents_original_filename, documents.mime_type AS documents_mime_type, documents.file_size AS documents_file_size, documents.file_hash AS documents_file_hash, documents.uploaded_by AS documents_uploaded_by, documents.version AS documents_version, documents.created_at AS documents_created_at 
FROM documents 
WHERE documents.application_id IN ($1::UUID)
2026-02-12 20:10:49,563 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:10:49,564 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:10:49,564 INFO sqlalchemy.engine.Engine SELECT application_status_history.application_id AS application_status_history_application_id, application_status_history.id AS application_status_history_id, application_status_history.old_status AS application_status_history_old_status, application_status_history.new_status AS application_status_history_new_status, application_status_history.changed_by AS application_status_history_changed_by, application_status_history.reason AS application_status_history_reason, application_status_history.created_at AS application_status_history_created_at 
FROM application_status_history 
WHERE application_status_history.application_id IN ($1::UUID) ORDER BY application_status_history.created_at DESC
2026-02-12 20:10:49,564 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
INFO:     127.0.0.1:52174 - "GET /api/v1/applications HTTP/1.1" 200 OK
2026-02-12 20:10:49,566 INFO sqlalchemy.engine.Engine SELECT application_comments.application_id AS application_comments_application_id, application_comments.id AS application_comments_id, application_comments.user_id AS application_comments_user_id, application_comments.text AS application_comments_text, application_comments.is_internal AS application_comments_is_internal, application_comments.created_at AS application_comments_created_at 
FROM application_comments 
WHERE application_comments.application_id IN ($1::UUID) ORDER BY application_comments.created_at DESC
2026-02-12 20:10:49,566 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:10:49,566 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,566 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,566 INFO sqlalchemy.engine.Engine [cached since 328.6s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:10:49,567 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:10:49,567 INFO sqlalchemy.engine.Engine [cached since 314.5s ago] ('markup_percent',)
2026-02-12 20:10:49,567 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,567 INFO sqlalchemy.engine.Engine SELECT settings.id, settings.key, settings.value, settings.description, settings.updated_by, settings.updated_at 
FROM settings 
WHERE settings.key = $1::VARCHAR
2026-02-12 20:10:49,567 INFO sqlalchemy.engine.Engine [cached since 314.5s ago] ('markup_percent',)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,568 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.role = $1::role ORDER BY users.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER
2026-02-12 20:10:49,568 INFO sqlalchemy.engine.Engine [cached since 142.6s ago] ('MANAGER', 100, 0)
2026-02-12 20:10:49,568 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:10:49,568 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52178 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa HTTP/1.1" 200 OK
INFO:     127.0.0.1:52176 - "GET /api/v1/users?role=manager&per_page=100 HTTP/1.1" 200 OK
2026-02-12 20:10:49,569 INFO sqlalchemy.engine.Engine SELECT count(*) AS count_1 
FROM (SELECT cars_catalog.id AS id, cars_catalog.source AS source, cars_catalog.source_url AS source_url, cars_catalog.external_id AS external_id, cars_catalog.brand AS brand, cars_catalog.make AS make, cars_catalog.model AS model, cars_catalog.year AS year, cars_catalog.trim AS trim, cars_catalog.body_type AS body_type, cars_catalog.mileage AS mileage, cars_catalog.exterior_color AS exterior_color, cars_catalog.interior_color AS interior_color, cars_catalog.transmission AS transmission, cars_catalog.drivetrain AS drivetrain, cars_catalog.fuel_type AS fuel_type, cars_catalog.engine AS engine, cars_catalog.mpg_city AS mpg_city, cars_catalog.mpg_highway AS mpg_highway, cars_catalog.vin AS vin, cars_catalog.source_price_usd AS source_price_usd, cars_catalog.final_price_usd AS final_price_usd, cars_catalog.dealer AS dealer, cars_catalog.location_city AS location_city, cars_catalog.location_state AS location_state, cars_catalog.location AS location, cars_catalog.image_url AS image_url, cars_catalog.photos AS photos, cars_catalog.features AS features, cars_catalog.status AS status, cars_catalog.is_active AS is_active, cars_catalog.parsed_at AS parsed_at, cars_catalog.last_seen_at AS last_seen_at, cars_catalog.source_updated_at AS source_updated_at, cars_catalog.created_at AS created_at, cars_catalog.updated_at AS updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC) AS anon_1
2026-02-12 20:10:49,569 INFO sqlalchemy.engine.Engine [cached since 314.5s ago] ()
INFO:     127.0.0.1:52176 - "OPTIONS /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
2026-02-12 20:10:49,571 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,571 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,571 INFO sqlalchemy.engine.Engine [cached since 328.7s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,571 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:10:49,571 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:10:49,572 INFO sqlalchemy.engine.Engine SELECT cars_catalog.id, cars_catalog.source, cars_catalog.source_url, cars_catalog.external_id, cars_catalog.brand, cars_catalog.make, cars_catalog.model, cars_catalog.year, cars_catalog.trim, cars_catalog.body_type, cars_catalog.mileage, cars_catalog.exterior_color, cars_catalog.interior_color, cars_catalog.transmission, cars_catalog.drivetrain, cars_catalog.fuel_type, cars_catalog.engine, cars_catalog.mpg_city, cars_catalog.mpg_highway, cars_catalog.vin, cars_catalog.source_price_usd, cars_catalog.final_price_usd, cars_catalog.dealer, cars_catalog.location_city, cars_catalog.location_state, cars_catalog.location, cars_catalog.image_url, cars_catalog.photos, cars_catalog.features, cars_catalog.status, cars_catalog.is_active, cars_catalog.parsed_at, cars_catalog.last_seen_at, cars_catalog.source_updated_at, cars_catalog.created_at, cars_catalog.updated_at 
FROM cars_catalog 
WHERE cars_catalog.is_active = true ORDER BY cars_catalog.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2026-02-12 20:10:49,572 INFO sqlalchemy.engine.Engine [cached since 142.6s ago] (50, 0)
2026-02-12 20:10:49,572 INFO sqlalchemy.engine.Engine SELECT application_comments.id, application_comments.application_id, application_comments.user_id, application_comments.text, application_comments.is_internal, application_comments.created_at 
FROM application_comments 
WHERE application_comments.application_id = $1::UUID ORDER BY application_comments.created_at DESC
2026-02-12 20:10:49,572 INFO sqlalchemy.engine.Engine [generated in 0.00007s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:10:49,573 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:10:49,573 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52177 - "GET /api/v1/cars?is_active=true&per_page=50 HTTP/1.1" 200 OK
INFO:     127.0.0.1:52178 - "GET /api/v1/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/comments HTTP/1.1" 200 OK
INFO:     127.0.0.1:52177 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
INFO:     127.0.0.1:52178 - "OPTIONS /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
2026-02-12 20:10:49,583 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,583 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,583 INFO sqlalchemy.engine.Engine [cached since 328.7s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
2026-02-12 20:10:49,583 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2026-02-12 20:10:49,583 INFO sqlalchemy.engine.Engine SELECT users.id, users.phone, users.email, users.password_hash, users.first_name, users.last_name, users.role, users.is_active, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-12 20:10:49,583 INFO sqlalchemy.engine.Engine [cached since 328.7s ago] (UUID('63048648-dacc-4d94-b87f-3e1068869cdd'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,584 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:10:49,584 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
AUTH DEBUG: User +998901111111 role=admin normalized=admin
2026-02-12 20:10:49,584 INFO sqlalchemy.engine.Engine SELECT applications.id, applications.client_id, applications.car_id, applications.operator_id, applications.manager_id, applications.source_price_snapshot, applications.markup_percent, applications.final_price, applications.status, applications.contact_status, applications.checklist, applications.rejection_reason, applications.rejection_note, applications.operator_comment, applications.internal_note, applications.car_confirmed, applications.car_confirmed_by, applications.car_confirmed_at, applications.cargo_booking_number, applications.cargo_notes, applications.created_at, applications.updated_at 
FROM applications 
WHERE applications.id = $1::UUID
2026-02-12 20:10:49,584 INFO sqlalchemy.engine.Engine [cached since 146.9s ago] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'),)
2026-02-12 20:10:49,585 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type = $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 20:10:49,585 INFO sqlalchemy.engine.Engine [generated in 0.00006s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 20:10:49,586 INFO sqlalchemy.engine.Engine SELECT documents.id, documents.application_id, documents.type, documents.file_path, documents.original_filename, documents.mime_type, documents.file_size, documents.file_hash, documents.uploaded_by, documents.version, documents.created_at 
FROM documents 
WHERE documents.application_id = $1::UUID AND documents.type != $2::documenttype ORDER BY documents.created_at DESC
2026-02-12 20:10:49,586 INFO sqlalchemy.engine.Engine [generated in 0.00007s] (UUID('aeef9d3b-4b07-4562-938a-216c105a6baa'), 'VIDEO_SIGNATURE')
2026-02-12 20:10:49,587 INFO sqlalchemy.engine.Engine COMMIT
2026-02-12 20:10:49,587 INFO sqlalchemy.engine.Engine COMMIT
INFO:     127.0.0.1:52177 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/videos HTTP/1.1" 200 OK
INFO:     127.0.0.1:52176 - "GET /api/v1/documents/applications/aeef9d3b-4b07-4562-938a-216c105a6baa/documents HTTP/1.1" 200 OK
